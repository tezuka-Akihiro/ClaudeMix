# ã€æ©Ÿèƒ½è¿½åŠ ã€‘blogè¨˜äº‹ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- **ã‚µãƒ¼ãƒ“ã‚¹**: `blog`
- **ã‚»ã‚¯ã‚·ãƒ§ãƒ³**: `post-detail`
- **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
  - `develop/blog/post-detail/func-spec.md`
  - `develop/blog/post-detail/uiux-spec.md`
  - `develop/blog/post-detail/file-list.md`
  - `develop/blog/post-detail/data-flow-diagram.md`
  - `develop/account/subscription/TDD_WORK_FLOW.md` (ä¾å­˜å…ˆ)

---

## 1. ææ¡ˆæ¦‚è¦

noteå‹ã®ã€Œå°å…¥éƒ¨åˆ†ã¯å…¬é–‹ã€æœ¬ç·¨ã¯ä¼šå“¡é™å®šã€ã¨ã„ã†è¡¨ç¤ºåˆ¶å¾¡ã‚’å®Ÿç¾ã—ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¿œã˜ã¦è¨˜äº‹ã®å¯è¦–ç¯„å›²ã‚’å‹•çš„ã«åˆ¶å¾¡ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åç›ŠåŒ–ã‚’æ”¯æ´ã—ã¾ã™ã€‚

## 2. å¤‰æ›´å†…å®¹ (As-Is / To-Be)

### ç¾çŠ¶ (As-Is)

- ã™ã¹ã¦ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã¯å…¨æ–‡ãŒç„¡æ–™ã§é–²è¦§å¯èƒ½
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¨ãƒ–ãƒ­ã‚°æ©Ÿèƒ½ã®é€£æºãŒå­˜åœ¨ã—ãªã„
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åç›ŠåŒ–æ©Ÿèƒ½ãŒãªã„

### ä¿®æ­£å¾Œ (To-Be)

- è¨˜äº‹ã®frontmatterã§`freeContentPercentage`ï¼ˆå…¬é–‹å‰²åˆã€0-100%ï¼‰ã‚’æŒ‡å®šå¯èƒ½
- æœªå¥‘ç´„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯æŒ‡å®šå‰²åˆã¾ã§ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿è¡¨ç¤ºã—ã€ãã‚Œä»¥é™ã«ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ï¼ˆç¶šãã‚’èª­ã‚€ãŸã‚ã®éšœå£ï¼‰ã‚’è¡¨ç¤º
- ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«å†…ã«è³¼èª­ä¿ƒé€²ãƒãƒŠãƒ¼ã‚’é…ç½®ã—ã€`/account/subscription`ã¸ã®CTAãƒœã‚¿ãƒ³ã§ä¼šå“¡ç™»éŒ²ã‚’ä¿ƒã™
- æœ‰åŠ¹ãªã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€è¨˜äº‹å…¨æ–‡ã‚’åˆ¶é™ãªãè¡¨ç¤º

## 3. èƒŒæ™¯ãƒ»ç›®çš„

### èƒŒæ™¯

- `project.toml`ã«ã¦post-detailã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®`abstract_purpose`ã«ã€Œã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¡Œã†ã€ã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯åæ˜ ã•ã‚Œã¦ã„ãªã„
- accountã‚µãƒ¼ãƒ“ã‚¹ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ãŒå®Ÿè£…äºˆå®šã§ã‚ã‚Šã€ãã®æ´»ç”¨å…ˆã¨ã—ã¦blogè¨˜äº‹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãŒå¿…è¦

### ç›®çš„

- **ç›®çš„1**: noteå‹ã®ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿç¾ã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åç›ŠåŒ–ã‚’æ”¯æ´
- **ç›®çš„2**: accountã‚µãƒ¼ãƒ“ã‚¹ã¨blogã‚µãƒ¼ãƒ“ã‚¹ã®é€£æºã‚’ç¢ºç«‹ã—ã€ã‚µãƒ¼ãƒ“ã‚¹é–“ã®ã‚·ãƒŠã‚¸ãƒ¼ã‚’å‰µå‡º
- **ç›®çš„3**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¾¡å€¤ã‚’æ˜ç¢ºã«æç¤ºã—ã€ä¼šå“¡ç™»éŒ²ã‚’ä¿ƒé€²

## 4. å¤‰æ›´ã®å¦¥å½“æ€§ (Pros / Cons)

Pros (åˆ©ç‚¹):

- ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã®å®Ÿç¾: blogã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰accountã‚µãƒ¼ãƒ“ã‚¹ã®data-ioå±¤ã‚’å‘¼ã³å‡ºã™æ˜ç¢ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºç«‹
- è²¬å‹™ã®é©åˆ‡ãªåˆ†é›¢: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ã€Œç®¡ç†ã€ã¯accountãŒæ‹…å½“ã—ã€ã€ŒçŠ¶æ…‹ã‚’å…ƒã«è¨˜äº‹ã‚’éƒ¨åˆ†è¡¨ç¤ºã™ã‚‹ã€ã®ã¯blogãŒæ‹…å½“
- ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã®å‘ä¸Š: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åç›ŠåŒ–ãƒ¢ãƒ‡ãƒ«ã‚’æä¾›
- 3å¤§å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®éµå®ˆ: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡åˆ¤å®šã‚’libå±¤ï¼ˆç´”ç²‹é–¢æ•°ï¼‰ã¨ã—ã¦å®Ÿè£…ã—ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’ç¢ºä¿

Cons (æ‡¸å¿µç‚¹):

- ã‚µãƒ¼ãƒ“ã‚¹é–“ä¾å­˜ã®ç™ºç”Ÿ: blogã‚µãƒ¼ãƒ“ã‚¹ãŒaccountã‚µãƒ¼ãƒ“ã‚¹ã®data-ioå±¤ã«ç›´æ¥ä¾å­˜
- å®Ÿè£…ã®è¤‡é›‘åŒ–: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—ã€å¯è¦–ç¯„å›²åˆ¤å®šãªã©å¤šå±¤ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦
- accountã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ãŒå…ˆè¡Œã—ã¦å¿…è¦: `getSubscriptionByUserId.server.ts`ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå‰æ

**ç·åˆè©•ä¾¡**:

Consã¯å­˜åœ¨ã™ã‚‹ã‚‚ã®ã®ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®æ¨™ã§ã‚ã‚‹ã€ŒRemix MVPãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã¨ã—ã¦ã€ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ç¤ºã™ã¨ã„ã†ç‚¹ã§ã€ã“ã®å¤‰æ›´ã¯**éå¸¸ã«å¦¥å½“æ€§ãŒé«˜ã„**ã¨åˆ¤æ–­ã—ã¾ã™ã€‚ã¾ãŸã€è²¬å‹™ã®åˆ†é›¢ãŒé©åˆ‡ã«è¡Œã‚ã‚Œã¦ãŠã‚Šã€3å¤§å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸå‰‡ã«åˆè‡´ã—ã¦ã„ã¾ã™ã€‚

## 5. è¨­è¨ˆãƒ•ãƒ­ãƒ¼

ä»¥ä¸‹ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¸Šã‹ã‚‰é †ã«ç¢ºèªã—ã€ç·¨é›†å†…å®¹ã‚’è¿½è¨˜ã—ã¾ã—ãŸã€‚

### ğŸ—¾GUIDING_PRINCIPLES.md

ï¼ˆå¤‰æ›´ãªã—: post-detailã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯GUIDING_PRINCIPLESã«å½±éŸ¿ã—ãªã„ï¼‰

### ğŸ“šï¸func-spec.md

è¿½åŠ å†…å®¹:

- åŸºæœ¬æ©Ÿèƒ½6: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- Routeè²¬å‹™: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼è¿½åŠ 
- Componentè²¬å‹™: ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ãƒ»è³¼èª­ä¿ƒé€²ãƒãƒŠãƒ¼è¡¨ç¤ºè¿½åŠ 
- ç´”ç²‹ãƒ­ã‚¸ãƒƒã‚¯è¦ä»¶: `determineContentVisibility.ts`ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¯è¦–ç¯„å›²åˆ¤å®šï¼‰è¿½åŠ 
- å‰¯ä½œç”¨è¦ä»¶: `getSubscriptionStatus.server.ts`ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—ï¼‰è¿½åŠ 

### ğŸ–¼ï¸uiux-spec.md

è¿½åŠ å†…å®¹:

- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ: Loaderã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—å‡¦ç†è¿½åŠ 
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ : Paywall Containerã€Subscription Promotion Bannerè¿½åŠ 
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã¨çŠ¶æ…‹é·ç§»: Paywallã€SubscriptionPromotionBannerã®çŠ¶æ…‹ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©

### ğŸ“‹ï¸spec.yaml

**æœªå®Ÿæ–½**ï¼ˆç¾æ™‚ç‚¹ã§ã¯ä¸è¦ã¨åˆ¤æ–­ï¼‰

ç†ç”±: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–¢é€£ã®è¨­å®šå€¤ã¯`app/specs/account/subscription-spec.yaml`ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã€post-detailã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®spec.yamlã«ã¯è¿½åŠ ä¸è¦

### ğŸ—‚ï¸file-list.md

è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«:

- UIå±¤: `Paywall.tsx`, `Paywall.test.tsx`, `SubscriptionPromotionBanner.tsx`, `SubscriptionPromotionBanner.test.tsx`
- ç´”ç²‹ãƒ­ã‚¸ãƒƒã‚¯å±¤: `determineContentVisibility.ts`, `determineContentVisibility.test.ts`
- å‰¯ä½œç”¨å±¤: `getSubscriptionStatus.server.ts`, `getSubscriptionStatus.server.test.ts`
- æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°: `PostDetailSection.tsx`ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«åŸºã¥ãã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶å¾¡è¿½åŠ ï¼‰

### ğŸ§¬data-flow-diagram.md

è¿½åŠ å†…å®¹:

- Mermaidå›³: ã€Œã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—ãƒ•ãƒ­ãƒ¼ã€ã€Œã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡åˆ¤å®šãƒ•ãƒ­ãƒ¼ã€è¿½åŠ 
- Routeå±¤è²¬å‹™: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡åˆ¤å®šè¿½åŠ 
- Componentå±¤è²¬å‹™: Paywallã€SubscriptionPromotionBannerè¿½åŠ 
- Pure Logicå±¤è²¬å‹™: `determineContentVisibility.ts`è¿½åŠ 
- Data-IOå±¤è²¬å‹™: `getSubscriptionStatus.server.ts`è¿½åŠ 
- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®èª¬æ˜: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–¢é€£ã®ãƒ•ãƒ­ãƒ¼è¿½åŠ 

## 6. TDD_WORK_FLOW.md ç°¡æ˜“ç‰ˆ

ä»¥ä¸‹ã®å…¨é …ç›®ã«å¯¾ã—ã¦ã€å®Ÿéš›ã®ãƒ‘ã‚¹ã¨ç·¨é›†å†…å®¹ã‚’1è¡Œã§è¨˜è¼‰ã—ã¾ã™ã€‚ç‰¹ã«ã€accountã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æºã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

### ğŸ‘ï¸e2e-screen-test

**ãƒ‘ã‚¹**: `tests/e2e/screen/blog/blog-post-detail.spec.ts`

**ç·¨é›†å†…å®¹**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®E2Eãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆæœªå¥‘ç´„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«è¡¨ç¤ºã€å¥‘ç´„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¨æ–‡è¡¨ç¤ºï¼‰

### ğŸ‘ï¸e2e-section-test

**ãƒ‘ã‚¹**: `tests/e2e/section/blog/post-detail.spec.ts`

**ç·¨é›†å†…å®¹**: æ—¢å­˜ãƒ†ã‚¹ãƒˆã«åŠ ãˆã¦ã€ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«è¡¨ç¤ºã€è³¼èª­ä¿ƒé€²ãƒãƒŠãƒ¼ã®CTAã‚¯ãƒªãƒƒã‚¯ã€å¯è¦–ç¯„å›²åˆ¶å¾¡ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

### ğŸ¨CSSå®Ÿè£… (layer2.css, layer3.ts, layer4.ts)

**ãƒ‘ã‚¹**:

- `app/styles/blog/layer2-post-detail.css`
- `app/styles/blog/layer3.ts`

**ç·¨é›†å†…å®¹**:

- Layer 2: `.paywall`, `.subscription-promotion-banner`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¯ãƒ©ã‚¹è¿½åŠ 
- Layer 3: ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã¨è³¼èª­ä¿ƒé€²ãƒãƒŠãƒ¼ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### ğŸª¨route

**ãƒ‘ã‚¹**: `app/routes/blog.$slug.tsx`

**ç·¨é›†å†…å®¹**:

- loaderã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—å‡¦ç†è¿½åŠ ï¼ˆ`getSubscriptionStatus.server.ts`å‘¼ã³å‡ºã—ï¼‰
- `determineContentVisibility.ts`ã‚’å‘¼ã³å‡ºã—ã¦ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡åˆ¤å®š
- loaderã®è¿”ã‚Šå€¤ã«`showFullContent`ã€`visiblePercentage`ã€`hasActiveSubscription`è¿½åŠ 

**é‡è¦ãªä¾å­˜é–¢ä¿‚**: accountã‚µãƒ¼ãƒ“ã‚¹ã®sessionãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå¿…è¦ï¼ˆ`getSessionBySessionId.server.ts`ï¼‰

### ğŸš§components.test

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:

- `app/components/blog/post-detail/Paywall.test.tsx`: ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
- `app/components/blog/post-detail/SubscriptionPromotionBanner.test.tsx`: è³¼èª­ä¿ƒé€²ãƒãƒŠãƒ¼ã®ãƒ†ã‚¹ãƒˆ

**æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**:

- `app/components/blog/post-detail/PostDetailSection.test.tsx`: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶å¾¡ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

### ğŸª¨components

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:

- `app/components/blog/post-detail/Paywall.tsx`: ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆSubscriptionPromotionBannerã‚’å†…åŒ…ï¼‰
- `app/components/blog/post-detail/SubscriptionPromotionBanner.tsx`: è³¼èª­ä¿ƒé€²ãƒãƒŠãƒ¼ï¼ˆãƒ—ãƒ©ãƒ³æƒ…å ±è¡¨ç¤ºã€CTAãƒœã‚¿ãƒ³ï¼‰

**æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**:

- `app/components/blog/post-detail/PostDetailSection.tsx`: `showFullContent`ã«åŸºã¥ã„ã¦Paywallè¡¨ç¤ºåˆ¶å¾¡è¿½åŠ 

### ğŸš§logic.test

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:

- `app/lib/blog/post-detail/determineContentVisibility.test.ts`: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆï¼ˆç´”ç²‹é–¢æ•°ï¼‰

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:

- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ– â†’ å…¨æ–‡è¡¨ç¤º
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éã‚¢ã‚¯ãƒ†ã‚£ãƒ– â†’ éƒ¨åˆ†è¡¨ç¤º
- å¢ƒç•Œå€¤ï¼ˆ0%/100%ï¼‰

### ğŸª¨logic

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:

- `app/lib/blog/post-detail/determineContentVisibility.ts`: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¨freeContentPercentageã‹ã‚‰å¯è¦–ç¯„å›²ã‚’åˆ¤å®šã™ã‚‹ç´”ç²‹é–¢æ•°

**ã‚·ã‚°ãƒãƒãƒ£**: `(hasActiveSubscription: boolean, freeContentPercentage: number) => { showFullContent: boolean, visiblePercentage: number }`

### ğŸš§data-io.test

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:

- `app/data-io/blog/post-detail/getSubscriptionStatus.server.test.ts`: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹å–å¾—ã®ãƒ†ã‚¹ãƒˆï¼ˆaccountã‚µãƒ¼ãƒ“ã‚¹data-ioå±¤ã®ãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:

- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ â†’ `hasActiveSubscription: true`
- éã‚¢ã‚¯ãƒ†ã‚£ãƒ–/å­˜åœ¨ã—ãªã„ â†’ `hasActiveSubscription: false`
- accountã‚µãƒ¼ãƒ“ã‚¹data-ioå±¤ã‚¨ãƒ©ãƒ¼ â†’ å®‰å…¨å´ã«å€’ã™ï¼ˆ`false`ï¼‰

### ğŸª¨data-io

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**:

- `app/data-io/blog/post-detail/getSubscriptionStatus.server.ts`: accountã‚µãƒ¼ãƒ“ã‚¹ã®data-ioå±¤ã‚’å‘¼ã³å‡ºã—ã¦ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å–å¾—

**é‡è¦ãªä¾å­˜é–¢ä¿‚**:

- `app/data-io/account/subscription/getSubscriptionByUserId.server.ts`ï¼ˆaccountã‚µãƒ¼ãƒ“ã‚¹ï¼‰
- ã“ã®é–¢æ•°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå‰æ

**æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**:

- `app/data-io/blog/post-detail/fetchPostBySlug.server.ts`: frontmatterã‹ã‚‰`freeContentPercentage`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª­ã¿è¾¼ã‚€å‡¦ç†è¿½åŠ 

### ãã®ä»–

**é‡è¦ãªå®Ÿè£…é †åºã®è€ƒæ…®äº‹é …**:

1. **accountã‚µãƒ¼ãƒ“ã‚¹ã®å…ˆè¡Œå®Ÿè£…ãŒå¿…é ˆ**:
   - `app/data-io/account/subscription/getSubscriptionByUserId.server.ts`
   - `app/data-io/account/common/getSessionBySessionId.server.ts`
   - ã“ã‚Œã‚‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„å ´åˆã€blogã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡æ©Ÿèƒ½ã¯ãƒ¢ãƒƒã‚¯ã§ã®ãƒ†ã‚¹ãƒˆã®ã¿å¯èƒ½

2. **ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**:
   - å˜ä½“ãƒ†ã‚¹ãƒˆ: accountã‚µãƒ¼ãƒ“ã‚¹data-ioå±¤ã‚’ãƒ¢ãƒƒã‚¯åŒ–
   - çµ±åˆãƒ†ã‚¹ãƒˆ: å®Ÿéš›ã®accountã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã‚’ä½¿ç”¨
   - E2Eãƒ†ã‚¹ãƒˆ: å®Œå…¨ãªã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã‚’æ¤œè¨¼

3. **æ®µéšçš„ãªå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
   - Phase 1: libå±¤ï¼ˆ`determineContentVisibility.ts`ï¼‰ã®å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆï¼ˆaccountã‚µãƒ¼ãƒ“ã‚¹ä¸è¦ï¼‰
   - Phase 2: data-ioå±¤ï¼ˆ`getSubscriptionStatus.server.ts`ï¼‰ã®ãƒ¢ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆ
   - Phase 3: UIå±¤ï¼ˆPaywallã€SubscriptionPromotionBannerï¼‰ã®å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆ
   - Phase 4: accountã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…å¾Œã€çµ±åˆãƒ†ã‚¹ãƒˆã¨E2Eãƒ†ã‚¹ãƒˆ

4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥**:
   - accountã‚µãƒ¼ãƒ“ã‚¹æœªå®Ÿè£…æ™‚: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æœªå¥‘ç´„ã¨ã—ã¦æ‰±ã†ï¼ˆå®‰å…¨å´ã«å€’ã™ï¼‰
   - ã‚¨ãƒ©ãƒ¼æ™‚: ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã‚’è¡¨ç¤ºã—ã€è¨˜äº‹ã‚’åˆ¶é™ã™ã‚‹æ–¹å‘ã§å‹•ä½œ

---

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: accountã‚µãƒ¼ãƒ“ã‚¹ã®TDD_WORK_FLOW.mdã§`getSubscriptionByUserId.server.ts`ã®å®Ÿè£…é †åºã‚’ç¢ºèªã—ã€blogã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
