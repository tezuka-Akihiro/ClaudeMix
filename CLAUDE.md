
# 🤖 AIエージェント行動規範マニュアル

このドキュメントは、あなたのAIエージェントとしての行動を規定する、外部から変更不可能なソフトウェア製造ラインの設計図です。すべてのタスクは、この規範に従い、以下のプロセスを自律的に実行してください。

---

## 🥇 1. 最上位行動原則 (マスター・ルール)

- **唯一の規範**: 開発フローは以下の2層で定義されています。他のドキュメントの記述と矛盾する場合、これらが常に優先されます。
  - **Lv1: フロー骨格** (`docs/boilerplate_architecture/開発フロー簡略図.md`): 絵文字数式による開発の全体構造。テンプレート生成対象ファイルと生成順序を定義。
  - **Lv2: フロー詳細** (`docs/boilerplate_architecture/` 配下の各フロー定義書): 各フェーズの具体的な手順、中間成果物、検証方法を定義。
  - **重要**: これらに記載されていない手順は実行禁止です。記載された手順からの逸脱は許可されません。
- **自律性の原則**: オペレーター（人間）からの指示は、「Phase 2.1を完了せよ」など、フローのステップ指定のみです。あなたは、そのステップを完了するために必要なサブエージェント利用、ファイル生成、リント実行、テスト実行のすべてを自律的に判断・実行してください。
- **ドキュメントの更新**: 作業完了時、またはステータス変更時、必ず関連する **`TDD_WORK_FLOW.md` の進捗ログを正確に更新**し、進捗を人間と共有してください。

## 🗺️ 2. 開発フロー数式マニフェスト (実行可能な設計図)

以下の数式が、あなたの行動の全工程と順序を規定します。すべての作業は、このレール上でのみ実行可能です。

## 🛡️ 3. AIガードレールと自己チェック機構

あなたのコード品質とアーキテクチャ規律の遵守は、以下のコード化されたガードレールによって監視されます。あなたは、コード生成後、コミット前にこれらのチェックを自律的に実行し、不合格の場合は自己修正する責務があります。

| ガードレール項目 | 対応するスクリプト | 違反時の対処 |
| :--- | :--- | :--- |
| **I. コーディング規律の強制** | `node scripts/lint-template/engine.js` | 行数制限（ファイル400行）や、デザイントークン以外のハードコード（例: `#FFFFFF`）を検出。違反箇所を最小限の修正で是正してください。 |
| **II. スコープ逸脱の監視** | `node scripts/lint-template/engine.js` | 禁止ワード（例: プロジェクト範囲超過、不適切な外部サービス名）を提案または実装に含めていないかをチェック。違反箇所は直ちに削除し、MVPスコープを遵守してください。 |
| **III. スタイリング規律の強制** | `docs/CSS_structure/STYLING_CHARTER.md` | **実装者は常に「Tailwindクラス」のみを参照すること**。`globals.css`のカスタムクラスやトークンへの直接参照は禁止。階層飛越も禁止。詳細: [`STYLING_CHARTER.md`](docs/CSS_structure/STYLING_CHARTER.md) |
| **IV. スタイリング規律の検証** | `npm run lint:css-arch` | `globals.css`の規約違反や、実装層でのTailwindユーティリティクラスの直接使用を検出します。違反があった場合は、`tests/lint/css-arch-layer-report.md` の内容に従って修正してください。 |
| **V. ファイルリスト整合性の検証** | `node scripts/lint-file-list/check-diff.js <develop-section-path>` | file-list.mdに未定義のファイルを検出。設計書への追加または不要ファイルの削除を実施してください。 |
| **VI. Single Source of Truth (SSoT) の徹底** | コードレビュー, `specloader` | **`spec.yaml` を唯一の信頼できる情報源とします。** (1)値の一元管理: カテゴリID、UIセレクタ、ビジネスルール等のリテラル値は `spec.yaml` で定義し、ハードコードを禁止。(2)動的参照: 実装・テストでは `specloader` 等のユーティリティを介して `spec.yaml` の値を動的に参照。(3)汎用的な記述: 設計書や実装コメントでは、「複数回」「特定の条件下で」のような汎用表現を用い、具体的な値を記述しません（例: `3回` はNG）。(4)参照案内の禁止: 「`spec.yaml` を参照」といったコメントは、コードの自己説明性を損なうため禁止。 |

## 📐 4. 3大層アーキテクチャの責務（層別TDDの規範）

TDDの `` `\text{🪨}\text{🚧}` `` サイクルにおける各層の責務を厳格に守ってください。

| 層 | 責務 | 許可される操作 | 禁止される操作 |
| :--- | :--- | :--- | :--- |
| **UI層** (`Route`, `Component`) | ユーザーとのインタラクションとビューの描画。 | `loader`, `action` の定義、UIロジック、Componentのレンダリング。 | データベース直接アクセス、外部APIの直接呼び出し。 |
| **純粋ロジック層** (`Logic`) | 複雑なビジネスロジックの処理。 | 入出力型を用いた純粋関数の実行。 | 副作用（API呼び出し、ファイルI/O）の実行。 |
| **副作用層** (`Data-IO`) | 外部システムとの通信。 | DBアクセス、`fetch` APIコール。 | UIコンポーネントのインポート、DOM操作。 |

---

あなたの目標は、この規範に従い、完璧なコードを製造することです。

## 🧠 5. 知識集積層の活用

開発プロセスで得られた暗黙知を形式知化し、将来の意思決定を支援するための知識ベースを構築します。

| ディレクトリ | 目的 | 記録内容 |
| :--- | :--- | :--- |
| `docs/thinking/` | 設計判断や思考過程を外部化する。 | 迷った点、却下した案、判断理由などを短文で記録します。 |
| `_docs/features/` | 新機能の追加・改修の目的と背景を記録する。 | AIが設計意図を理解できるよう、実装目的、画面構成、データ構造、リスク、完了条件などを簡潔にまとめます。 |
| `docs/deleted/` | 削除・廃止した機能やファイルの履歴を残す。 | 削除理由、影響範囲、代替手段、再発防止策を記録します。 |
