# 【機能修正提案】デフォルトサムネイル追加

## 1. 提案概要
R2にサムネイル画像が存在しない場合、カテゴリに応じたデフォルト画像（public/配下）を表示するフォールバック機能を実装します。

## 2. 変更内容 (As-Is / To-Be)
- **As-Is**:
  - R2に画像が存在しない場合、サムネイルエリアを非表示にする（`fallback: "hide"`）。
  - 「インフォメーション」カテゴリは一律でサムネイルを非表示にしている。
- **To-Be**:
  - R2に画像が存在しない（またはエラーが発生した）場合、カテゴリごとのデフォルト画像を表示する。
  - カテゴリごとのデフォルト画像：
    - ClaudeMix ガイド/記録/考察: `public/core-matrix-emblem.avif`
    - 起業: `public/category-entrepreneurship.avif`
    - インフォメーション: `public/category-information.avif`
  - 「インフォメーション」カテゴリの非表示設定（`suppressed_categories`）を解除する。

## 3. 背景・目的
- 記事一覧の視覚的な統一感を維持するため。
- R2への画像アップロードが遅れた場合や、特定のカテゴリで固定画像を使いたい場合の運用負荷を軽減するため。

## 4. 変更の妥当性 (Pros / Cons)
- **Pros**:
  - 記事一覧がスカスカになるのを防ぎ、ブランドイメージを維持できる。
  - カテゴリごとに適したデフォルト画像を表示することで、アクセシビリティと判別性が向上する。
- **Cons**:
  - デフォルト画像のアセット管理が必要になる。
  - 画像読み込みエラー発生時に1回のリトライ（srcの切り替え）が発生する。

## 5. 設計フロー

### 5-1. GUIDING_PRINCIPLES.md
- 変更なし。

### 5-2. func-spec.md (blog/posts, blog/post-detail)
- サムネイル取得のフォールバック仕様を更新。
- R2画像取得エラー時、カテゴリに対応するデフォルト画像を `public/` から取得して表示する。

### 5-3. uiux-spec.md (blog/posts, blog/post-detail)
- 変更なし（表示される画像が変わるのみ）。

### 5-4. spec.yaml
- `app/specs/blog/posts-spec.yaml`:
  - `thumbnail.display.fallback` を `"default"` に変更。
  - `thumbnail.display.suppressed_categories` から `"インフォメーション"` を削除。
  - `thumbnail.display.default_mapping` を追加し、カテゴリと画像パスの対応を定義。

### 5-5. file_list.md
- 変更なし。

### 5-6. data-flow-diagram.md
- 変更なし。

## 6. TDDワークフロー

### 6-1. logic.test
- `app/lib/blog/common/getFallbackThumbnailUrl.test.ts`: カテゴリに応じた適切なデフォルト画像パスが返ることをテスト。

### 6-2. logic
- `app/lib/blog/common/getFallbackThumbnailUrl.ts`: テストをパスする実装を追加。

### 6-3. data-io
- `app/data-io/blog/posts/fetchPosts.server.ts`: `suppressed_categories` のチェックを更新（または spec の更新により自動的に挙動が変わることを確認）。

### 6-4. route
- `app/routes/blog.$slug.tsx`: 個別記事ページでのサムネイル抑制ロジックを spec に合わせる。

### 6-5. components.test
- `app/components/blog/posts/PostCard.test.tsx`: 画像エラー時にデフォルト画像に切り替わる挙動をテスト。
- `app/components/blog/post-detail/PostDetailSection.test.tsx`: 同上。

### 6-6. components
- `app/components/blog/posts/PostCard.tsx`: `onError` ハンドラ内でデフォルト画像への切り替えロジックを実装。
- `app/components/blog/post-detail/PostDetailSection.tsx`: 同上。

### 6-7. e2e-section-test
- `tests/e2e/blog/posts.spec.ts`: インフォメーションカテゴリの記事にサムネイルが表示されていることを確認。
