# flow-auditor - common - å¤–éƒ¨å¤‰æ•°ä»•æ§˜æ›¸
# Header/Footerå…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¨­å®šå€¤ãƒ»å®šæ•°å®šç¾©

# APIä»•æ§˜
api:
  endpoints:
    - name: getCommonData
      method: GET
      path: /flow-auditor
      description: Header/Footerè¡¨ç¤ºã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ˆloaderçµŒç”±ï¼‰

    - name: executeRetry
      method: POST
      path: /flow-auditor
      description: ãƒªãƒˆãƒ©ã‚¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€å¯¾è±¡ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä»¥é™ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹

    - name: refreshData
      method: POST
      path: /flow-auditor
      description: ãƒ‡ãƒ¼ã‚¿ã‚’æœ€æ–°åŒ–ã™ã‚‹ãŸã‚ã«loaderã‚’å†å®Ÿè¡Œã™ã‚‹

# ãƒ‡ãƒ¼ã‚¿å‹å®šç¾©
types:
  HeaderData:
    services: string[] # åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ï¼ˆä¾‹: ["flow-auditor", "flow-auditor"]ï¼‰
    selectedService: string # ç¾åœ¨é¸æŠä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹å
    sections: string[] # é¸æŠä¸­ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆä¾‹: ["common", "design-flow", "implementation-flow"]ï¼‰
    selectedSection: string # ç¾åœ¨é¸æŠä¸­ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³å
    lastUpdated: Date # æœ€çµ‚æ›´æ–°æ—¥æ™‚

  FooterData:
    selectedCheckpointId: string | null # URL SearchParamsã‹ã‚‰å–å¾—ï¼ˆä¾‹: "design-flow-operation-requirements"ï¼‰
    isRefreshing: boolean # æ›´æ–°ä¸­ãƒ•ãƒ©ã‚°
    designSteps: string[] # è¨­è¨ˆãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ï¼ˆRetryModalç”¨ï¼‰
    implementationSteps: string[] # å®Ÿè£…ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ï¼ˆRetryModalç”¨ï¼‰

  HeaderActions:
    onServiceChange: "(serviceName: string) => void" # ã‚µãƒ¼ãƒ“ã‚¹é¸æŠå¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©
    onSectionChange: "(sectionName: string) => void" # ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠå¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©

  FooterActions:
    onRefresh: "() => void" # æ›´æ–°ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
    onRetryConfirm: "(target: 'project.toml' | 'design' | 'implementation', stepIndex?: number) => void" # ãƒªãƒˆãƒ©ã‚¤å®Ÿè¡Œãƒãƒ³ãƒ‰ãƒ©

  CommonLoaderData:
    services: string[]    selectedService: string
    sections: string[]
    selectedSection: string
    lastUpdated: Date
    selectedCheckpointId: string | null
    isRefreshing: boolean
    designSteps: string[]
    implementationSteps: string[]

  RetryRequest:
    checkpointId: string | null # design-flowç”¨ã®ãƒªãƒˆãƒ©ã‚¤èµ·ç‚¹ï¼ˆãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ãƒªãƒˆãƒ©ã‚¤ï¼‰
    targetFilePaths: string[] | null # implementation-flowç”¨ã®ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆï¼ˆSurgical Retryï¼‰

  RetryResponse:
    success: boolean # ãƒªãƒˆãƒ©ã‚¤æˆåŠŸãƒ•ãƒ©ã‚°
    archivedFiles: string[] # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ä¸€è¦§
    errorMessage: string | null # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå¤±æ•—æ™‚ï¼‰

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
validation:
  serviceName:
    required: true
    type: string
    description: "project.tomlã«ç™»éŒ²æ¸ˆã¿ã®ã‚µãƒ¼ãƒ“ã‚¹åã®ã¿è¨±å¯"

  sectionName:
    required: true
    type: string
    description: "é¸æŠä¸­ã‚µãƒ¼ãƒ“ã‚¹ã®project.tomlã«ç™»éŒ²æ¸ˆã¿ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã®ã¿è¨±å¯"
    enum: ["common", "design-flow", "implementation-flow"]

  selectedCheckpointId:
    required: false
    type: string | null
    pattern: "^[a-z-]+$"
    description: "ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆIDå½¢å¼: {flow}-{section}-{category} (ä¾‹: design-flow-operation-requirements)"
    format: "{flow}-{section}-{category}"

# å®šæ•°
constants:
  # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆflow-auditorã‚µãƒ¼ãƒ“ã‚¹ï¼‰
  FLOW_AUDITOR_SECTIONS:
    - "common"
    - "design-flow"
    - "implementation-flow"

  # URL SearchParamsã‚­ãƒ¼å
  URL_PARAMS:
    SELECTED_CHECKPOINT: "selectedCheckpoint"

  # è¨­è¨ˆãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ï¼ˆRetryModalç”¨ï¼‰
  DESIGN_STEPS:
    - "func-spec.md"
    - "uiux-spec.md"
    - "spec.yaml"
    - "TDD_WORK_FLOW.md"

  # å®Ÿè£…ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§ï¼ˆRetryModalç”¨ï¼‰
  IMPLEMENTATION_STEPS:
    - "E2E Test"
    - "UI Layer"
    - "Logic Layer"
    - "Data-IO Layer"

  # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  TIMESTAMP:
    JUST_NOW_THRESHOLD_MS: 60000 # 1åˆ†æœªæº€ã®å ´åˆã€ŒãŸã£ãŸä»Šã€
    FORMAT: "HH:MM" # 1åˆ†ä»¥ä¸Šã®å ´åˆã®è¡¨ç¤ºå½¢å¼

  # ãƒ­ãƒ¼ãƒ€ãƒ¼/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š
  LOADER_TIMEOUT_MS: 5000 # ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆmsï¼‰
  ACTION_TIMEOUT_MS: 10000 # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆmsï¼‰

  # ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ç¨®åˆ¥
  RETRY_TARGETS:
    PROJECT_TOML: "project.toml"
    DESIGN: "design"
    IMPLEMENTATION: "implementation"

  # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ãƒ†ãƒ³ãƒˆå
  ACTION_INTENTS:
    REFRESH: "refresh"
    RETRY: "retry"

# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆ
messages:
  # Headeré–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  header:
    service_label: "ã‚µãƒ¼ãƒ“ã‚¹"
    section_label: "ã‚»ã‚¯ã‚·ãƒ§ãƒ³"
    last_updated_label: "æœ€çµ‚æ›´æ–°"
    just_now: "ãŸã£ãŸä»Š"

  # Footeré–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  footer:
    refresh_button: "ğŸ”„ æ›´æ–°"
    refresh_loading: "â³ æ›´æ–°ä¸­..."
    retry_button: "ğŸ” ãƒªãƒˆãƒ©ã‚¤"
    retry_button_disabled: "ğŸ” ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœªé¸æŠï¼‰"

  # RetryModalé–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  retry_modal:
    title: "ãƒªãƒˆãƒ©ã‚¤ç¢ºèª"
    selected_checkpoint_label: "é¸æŠä¸­ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ:"
    target_label: "ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡:"
    target_project_toml: "project.tomlï¼ˆå…¨ãƒ•ãƒ­ãƒ¼å†å®Ÿè¡Œï¼‰"
    target_design: "designï¼ˆè¨­è¨ˆãƒ•ãƒ­ãƒ¼ã‹ã‚‰å†å®Ÿè¡Œï¼‰"
    target_implementation: "implementationï¼ˆå®Ÿè£…ãƒ•ãƒ­ãƒ¼ã‹ã‚‰å†å®Ÿè¡Œï¼‰"
    step_label: "ã‚¹ãƒ†ãƒƒãƒ—é¸æŠ:"
    warning_message: "âš ï¸ è­¦å‘Š: é¸æŠã—ãŸãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä»¥é™ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã¾ã™ã€‚"
    cancel_button: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«"
    confirm_button: "å®Ÿè¡Œ"
    confirm_button_disabled: "å®Ÿè¡Œï¼ˆæœªé¸æŠï¼‰"

  # æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  success:
    refresh_completed: "ãƒ‡ãƒ¼ã‚¿ã‚’æœ€æ–°åŒ–ã—ã¾ã—ãŸ"
    retry_completed: "ãƒªãƒˆãƒ©ã‚¤ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚{count}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã—ãŸã€‚"
    section_changed: "ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ: {sectionName}"

  # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  error:
    load_failed: "ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"
    invalid_service: "ç„¡åŠ¹ãªã‚µãƒ¼ãƒ“ã‚¹åãŒæŒ‡å®šã•ã‚Œã¾ã—ãŸ"
    invalid_section: "ç„¡åŠ¹ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³åãŒæŒ‡å®šã•ã‚Œã¾ã—ãŸ"
    invalid_checkpoint_id: "ç„¡åŠ¹ãªãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆIDãŒæŒ‡å®šã•ã‚Œã¾ã—ãŸ"
    retry_failed: "ãƒªãƒˆãƒ©ã‚¤ã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: {errorMessage}"
    no_checkpoint_selected: "ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“"
    missing_retry_target: "ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"

  # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  warning:
    no_sections_available: "ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ"
    no_services_available: "ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ"

# ãƒªãƒˆãƒ©ã‚¤æ“ä½œä»•æ§˜
retry_operation:
  # ãƒªãƒˆãƒ©ã‚¤ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆGUIDING_PRINCIPLES.mdã«è©³ç´°è¨˜è¼‰ï¼‰
  target_calculator:
    description: "é¸æŠã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä»¥é™ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®šã—ã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¯¾è±¡ã‚’æ±ºå®šã™ã‚‹"
    rules:
      - "project.tomlé¸æŠæ™‚: å…¨ãƒ•ãƒ­ãƒ¼ï¼ˆdesign + implementationï¼‰ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"
      - "designé¸æŠæ™‚: é¸æŠã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—ä»¥é™ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ + å®Ÿè£…ãƒ•ãƒ­ãƒ¼ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"
      - "implementationé¸æŠæ™‚: é¸æŠã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—ä»¥é™ã®å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"

  # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡
  archive_naming:
    directory: "develop/{serviceName}/_archive"
    file_suffix: "_{timestamp}"
    timestamp_format: "YYYYMMDDHHmmss"

  # å½±éŸ¿ç¯„å›²ã®ä¾‹
  examples:
    - input:
        target: "project.toml"
        checkpointId: "design-flow-operation-requirements"
      output:
        archivedFiles:
          - "develop/flow-auditor/operation/func-spec.md"
          - "develop/flow-auditor/operation/uiux-spec.md"
          - "develop/flow-auditor/operation/spec.yaml"
          - "develop/flow-auditor/operation/TDD_WORK_FLOW.md"
          - "develop/flow-auditor/operation/*.test.ts"
          - "develop/flow-auditor/operation/*.tsx"

    - input:
        target: "design"
        stepIndex: 1
        checkpointId: "design-flow-operation-requirements"
      output:
        archivedFiles:
          - "develop/flow-auditor/operation/uiux-spec.md"
          - "develop/flow-auditor/operation/spec.yaml"
          - "develop/flow-auditor/operation/TDD_WORK_FLOW.md"
          - "develop/flow-auditor/operation/*.test.ts"
          - "develop/flow-auditor/operation/*.tsx"

    - input:
        target: "implementation"
        stepIndex: 2
        checkpointId: "implementation-flow-operation-logic"
      output:
        archivedFiles:
          - "app/lib/flow-auditor/operation/*.ts"
          - "app/data-io/flow-auditor/operation/*.server.ts"

# ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ä»•æ§˜
accessibility:
  # ARIAãƒ©ãƒ™ãƒ«
  aria_labels:
    service_selector: "ã‚µãƒ¼ãƒ“ã‚¹é¸æŠ"
    section_selector: "ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ"
    last_updated_label: "æœ€çµ‚æ›´æ–°æ™‚åˆ»"
    refresh_button: "ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°"
    retry_button: "ãƒªãƒˆãƒ©ã‚¤ã‚’å®Ÿè¡Œ"
    retry_modal: "ãƒªãƒˆãƒ©ã‚¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°"

  # ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
  keyboard_navigation:
    tab_order:
      - "ServiceSelector"
      - "SectionSelector"
      - "RefreshButton"
      - "RetryButton"
    enter_space_activation: true
    arrow_navigation: true # ã‚»ãƒ¬ã‚¯ã‚¿å†…ã®é¸æŠè‚¢ç§»å‹•

  # ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”ï¼ˆWCAG AAæº–æ‹ ï¼‰
  contrast_ratios:
    cyan_on_dark: 7.2 # cyan-400 on dark background
    green_on_dark: 6.8 # green-400 on dark background
    minimum_required: 4.5 # WCAG AAåŸºæº–

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
performance:
  section_switching_max_ms: 100 # ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆé€Ÿåº¦
  refresh_feedback_max_ms: 300 # æ›´æ–°ãƒœã‚¿ãƒ³åå¿œé€Ÿåº¦
  modal_display_max_ms: 50 # RetryModalè¡¨ç¤ºé€Ÿåº¦

# ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³å‚ç…§
design_tokens:
  primary_color: "var(--flow-auditor-primary)" # cyan-400
  secondary_color: "var(--flow-auditor-secondary)" # green-400
  accent_color: "var(--flow-auditor-accent)" # blue-400
  bg_primary: "var(--flow-auditor-bg-primary)" # æš—ã„èƒŒæ™¯
  status_pending: "var(--flow-auditor-status-pending)" # gray-400
  status_error: "var(--flow-auditor-status-error)" # red-400
  font_family: "var(--flow-auditor-font-family)" # monospace
  glow_effect: "var(--flow-auditor-glow)" # cyan glow

# UIè¦ç´ ã‚»ãƒ¬ã‚¯ã‚¿ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
ui_selectors:
  header:
    container: "[data-testid='header-container']"
    service_selector: "[data-testid='service-selector']"
    section_selector: "[data-testid='section-selector']"
    last_updated: "[data-testid='last-updated-label']"

  footer:
    container: "[data-testid='footer-container']"
    refresh_button: "[data-testid='refresh-button']"
    retry_button: "[data-testid='retry-button']"

  retry_modal:
    container: "[data-testid='retry-modal']"
    overlay: "[data-testid='retry-modal-overlay']"
    title: "[data-testid='retry-modal-title']"
    checkpoint_label: "[data-testid='selected-checkpoint-label']"
    target_project_toml: "[data-testid='retry-target-project-toml']"
    target_design: "[data-testid='retry-target-design']"
    target_implementation: "[data-testid='retry-target-implementation']"
    step_dropdown: "[data-testid='retry-step-dropdown']"
    warning_message: "[data-testid='retry-warning-message']"
    cancel_button: "[data-testid='retry-cancel-button']"
    confirm_button: "[data-testid='retry-confirm-button']"
