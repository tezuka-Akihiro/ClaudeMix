# flow-auditor - operation - 外部変数仕様書

# API仕様
api:
  endpoints:
    - name: refresh
      method: POST
      path: /flow-auditor?index
      description: 全チェックポイントのファイル存在を再確認し、最新の進捗状態を返す

    - name: retry
      method: POST
      path: /flow-auditor?index
      description: 指定フェーズ・ステップ以降のファイルをアーカイブに移動し、フローを未完了状態に戻す

# データ型定義
types:
  CheckpointStatus:
    name: string # チェックポイント名（例: "func-spec.md"）
    path: string # ファイルパス（例: "develop/flow-auditor/operation/func-spec.md"）
    exists: boolean # 存在するか（true: 完了, false: 未完了）

  RefreshInput:
    _action: "refresh"

  RetryInput:
    _action: "retry"
    targetPhase: "design" | "implementation"
    stepIndex: number # 0以上の整数

# バリデーションルール
validation:
  targetPhase:
    required: true
    type: string
    enum: ["design", "implementation"]

  stepIndex:
    required: true
    type: number
    min: 0
    # max: フェーズの総ステップ数 - 1（動的に決定）

# 定数
constants:
  ARCHIVE_MAX_COUNT: 10 # 保持するアーカイブの最大数
  REFRESH_TIMEOUT_MS: 500 # 更新処理のタイムアウト（ms）
  RETRY_TIMEOUT_MS: 1000 # リトライ処理のタイムアウト（ms）
  ARCHIVE_DIR: "develop/archive" # アーカイブディレクトリのベースパス

# メッセージテキスト
messages:
  success:
    refreshed: "フロー状態を更新しました"
    retried: "フローを {phase} の {stepName} から戻しました"
  error:
    refresh_failed: "状態更新に失敗しました。再試行してください。"
    retry_failed: "リトライに失敗しました。ファイルが使用中の可能性があります。"
    invalid_phase: "無効なフェーズが指定されました"
    invalid_step_index: "無効なステップ番号が指定されました"
    archive_full: "アーカイブ容量が上限に達しています。古いアーカイブを削除してください。"
  warning:
    retry_confirm: "⚠️ {stepName} 以降のファイルがアーカイブされます。本当に実行しますか？"
