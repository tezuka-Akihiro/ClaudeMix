# ブログ記事企画書：Topic 2

## 1. 記事タイトル（仮）
E2Eテストを「文言の呪縛」から解放する：`extractTestId` による契約の分離

## 2. ターゲット
- **Primary**: PlaywrightやCypressなどのE2Eテストを導入しているが、文言修正のたびにテストが壊れて疲弊している開発者。
- **Secondary**: 変更に強いテスト設計、およびテストとUIの疎結合化に興味がある設計者。

## 3. 作業内容の整理（Why / What / Challenge / Solution）

### Why（なぜやるのか：課題）
- 従来のE2Eテストは `page.getByText("送信")` のように、ユーザー向けの「文言」に依存しがちである。
- 文言が「送信」から「保存する」に変わるだけでテストが失敗し、本質的でない修正コストが発生する。
- デザイナーが文言を改善する自由を、テストコードが奪ってしまっている（テストの呪縛）。

### What（何をしたのか：実装）
- **`extractTestId` ユーティリティの開発**: CSSセレクタ形式（`[data-testid='...']`）から `data-testid` の値だけを抽出するシンプルな関数を実装。
- **スペック駆動のテストID管理**: `spec.yaml` 内に `ui_selectors` を定義し、UI実装とテストコードの両方でこれを参照する仕組みを構築。
- **実装への適用**: コンポーネント側ではスペックから抽出したIDを `data-testid` に付与し、テスト側では同じスペックを参照して要素を特定。

### Challenge（壁：困難だった点）
- スペックファイル内では、将来のCSS拡張性を見越してフルセレクタ（`[data-testid='...']`）で記述したいが、Reactの `data-testid` 属性には純粋なID値だけを渡す必要がある。
- 重複するID定義を避け、いかにして「一箇所を直せば実装もテストも追従する」状態を作るか。

### Solution（どう乗り越えたか：解決策）
- **正規表現による抽出**: どのような形式のセレクタがスペックに書かれていても、一貫してID部分だけを取り出す `extractTestId` を作成。
- **テスト契約（Contract）の明文化**: スペックを「UIとテストの間の契約」と定義。ラベル（text）がどれほど変わろうとも、契約されたIDが変わらない限りテストはパスし続ける構造を実現。

## 4. 記事の提供価値と品質評価

### 提供価値のカテゴリ
- **ClaudeMix 考察**: テストの保守性を極限まで高める設計思想の解説。
- **ClaudeMix 記録**: 具体的なユーティリティ実装とテストコードへの適用ログ。

### 品質基準の評価
- **希少性（中）**: `data-testid` を使うこと自体は一般的だが、スペック（SSOT）から動的に抽出して「契約」として扱う設計は独自の工夫。
- **具体性（高）**: `extractTestId.ts` のコードと、それを `spec.yaml` および `BlogHeader.tsx` 等でどう使うかの実例を提示。
- **新規性（中）**: AIによるコード生成時にも、このIDがガードレールとして機能する点。
- **実証性（高）**: 実際にアカウント管理機能やブログ機能の全コンポーネントでこのパターンが適用されており、文言変更によるテスト失敗をゼロに抑えている。

## 5. 導入部分の構成（恐怖型BAB法）

### Before（現状の痛み：恐怖の提示）
「ボタンの文言を『OK』から『了解』に変えてもいいですか？」
その一言に、あなたは青ざめます。文言一つを変えるだけで、数十件のE2Eテストが真っ赤に染まり、数時間の修正作業が確定するからです。
テストが品質を守るための盾ではなく、改善を阻む足枷（あかせ）になっていませんか？

### After（解決後の未来：希望の提示）
ラベルが日本語になろうと英語になろうと、あるいは「購入」が「今すぐチェック」になろうと、テストコードは一切変更不要です。
デザイナーは文言のブラッシュアップに集中でき、開発者はビジネスロジックの修正に専念できます。テストは不変の「契約」として、背後で静かに、そして確実に品質を保証し続けます。

### Bridge（解決策の提示：この記事でわかること）
その魔法の正体は、1つのユーティリティと、スペック中心の設計思想にあります。
この記事では、UIの文言からテストを切り離し、真の意味で「変更に強い」E2Eテストを構築するための `extractTestId` パターンを公開します。

## 6. カテゴリ・タグ
- **カテゴリ**: ClaudeMix 考察
- **タグ**: testing, Playwright, refactoring, SSOT, architecture

## 7. オペレーターへの確認事項
- Playwrightの `getByTestId` だけでなく、ユニットテスト（Vitest/React Testing Library）での利用例も併せて紹介しますか？
