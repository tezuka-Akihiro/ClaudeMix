# blog サービス開発原則 (GUIDING_PRINCIPLES)

## 1. 目的とスコープ

このドキュメントは、`blog` サービス開発における技術的な方針、アーキテクチャ原則、および品質基準を定義します。
以降のすべての設計ドキュメント（`func-spec.md`, `uiux-spec.md` など）は、この原則に従って作成されなければなりません。

**サービス概要**:
- **目的**: Remixとclaude codeを用いた開発の知見を共有し、技術情報を発信するブログプラットフォームを提供する
- **主要機能**:
  - 記事の一覧表示（時系列リスト）
  - 記事詳細の閲覧（マークダウン形式の記事を整形表示）
  - 目次アンカーリンク（見出しへのページ内ナビゲーション）
  - SEO対応（meta関数実装、OGP対応）
  - OGP画像の動的生成（記事ごとのSNSシェア用画像）
  - 記事フィルタリング（カテゴリ・タグによる絞り込み）
- **ターゲットユーザー**: Remixやclaude codeに興味を持つ開発者、技術ブログの読者

**開発スコープ**:
- **範囲内 (In Scope)**: 記事の一覧表示と記事の閲覧、SEO対応、カテゴリとタグによる記事フィルタリング
- **範囲外 (Out of Scope)**: 記事の作成編集削除等、お気に入り、いいね、コメント、共有ボタン、固定記事、ワイヤーフレームに無いUI要素やラベル

---

## 2. 遵守すべきアーキテクチャ原則

このサービスは、プロジェクトのボイラープレートで定義された以下の主要なアーキテクチャ原則を厳格に遵守します。詳細な規約については、各ドキュメントを参照してください。

- **3大層分離アーキテクチャ**: `CLAUDE.md` および `README.md` に記載の通り、UI層・純粋ロジック層・副作用層の責務を分離します。
- **Outside-In TDD**: `TDD_WORK_FLOW.md` に記載された開発フローに従います。
- **スタイリング憲章**: `docs/CSS_structure/STYLING_CHARTER.md` に基づくCSS階層アーキテクチャを遵守します。

---

## 3. ルーティング規約

**採用パターン**: **Remix v2 Flat Routes規則**を採用します。フォルダベース形式は使用しません。

**命名規則**:
| パターン | ファイル名 | 生成されるURL | 備考 |
|:---|:---|:---|:---|
| インデックスルート | `blog._index.tsx` | `/blog` | アンダースコア必須 |
| 動的ルート | `blog.$slug.tsx` | `/blog/:slug` | `$`で動的パラメータを表現 |

**URL設計**:
- **記事一覧**: `/blog` → `app/routes/blog._index.tsx`
- **記事詳細**: `/blog/:slug` → `app/routes/blog.$slug.tsx`
  - 例: `/blog/remix-tips-2024`

**技術的制約**:
- フォルダベース（`blog/index.tsx`）は親ルートファイル（`blog.tsx`）が必要なため不採用
- Flat Routes形式により、ルート直下でblog関連のルートファイルが明示的に管理される
- 動的パラメータ（slug）はloaderで`params.slug`として取得

---

## 4. セクション間連携と共通化方針

**セクション定義** - このサービスは以下の3つのセクションで構成されます：
- **`common`**: サービス全体で共有されるヘッダー、フッター、レイアウトコンポーネント
- **`posts`**: 記事一覧ページ。投稿されたブログ記事を時系列で一覧表示し、各記事へのリンクを提供する
- **`post-detail`**: 記事詳細ページ。個別のブログ記事の詳細（タイトル、本文、投稿日、著者など）を表示する

**共通コンポーネントの配置ルール**:
- **基本方針**: サービス内共通コンポーネントは `app/components/blog/common/` に配置します
- **プロジェクト共通コンポーネント**: プロジェクト全体で利用されるコンポーネントは、オペレーターに相談の上、適切な場所に配置する
- **file-list.md管理方針**: 複数セクションで共有されるコンポーネントは、commonセクションのfile-list.mdに記載します

**実装順序**:
- **重要**: `common`セクションは、他のセクションよりも**必ず先に実装**してください。他のセクションが共通コンポーネントに依存する可能性があるためです
- **重要**: 共有コンポーネントは実装ファイルが1つでも、設計書では各セクションの責務として明記することで、依存関係を可視化します

**データフロー**:
```mermaid
graph TD
    A[/blog Route] -->|loader| B[記事一覧取得]
    B --> C[PostsSection Component]
    D[/blog/:slug Route] -->|loader| E[記事詳細取得]
    E --> F[PostDetailSection Component]

    B --> G[Data-IO層: 記事データ取得]
    E --> G
    G --> H[Lib層: マークダウン変換処理]
    H --> I[Lib層: 見出し抽出・ID付与]
```

**主要なデータフロー**:
1. **記事一覧**: Route → data-io（記事リスト取得） → UI（一覧表示）
2. **記事詳細**: Route → data-io（記事データ取得） → lib（マークダウン変換） → UI（整形表示）

---

## 4. 用語集 (Glossary)

このサービス開発で使用される主要な用語、英単語の日本語訳、および略語の定義を以下に示します。一貫したコミュニケーションと実装のために、これらの定義に従ってください。

| 用語 (Term) | 定義・翻訳 (Definition/Translation) | 備考・使用例 (Notes/Examples) |
|:---|:---|:---|
| Post | 投稿記事 | ブログの個別記事を指す |
| Slug | URL識別子 | 記事のパスに使用される一意の文字列。例: `remix-tips-2024` |
| Section | サービスを構成する機能単位 | 例: `common`, `posts`, `post-detail` |
| Markdown | マークダウン形式 | 記事本文の記述形式 |
| Heading | 見出し | h1-h6タグ。目次の構成要素 |
| Anchor Link | アンカーリンク | ページ内の特定要素へのリンク |
| Table of Contents | 目次 | 記事内の見出し一覧。略称: TOC |
| Description | 記事の要約 | 150-160文字推奨。SEOとSNSシェアに使用 |
| Tags | タグ | 記事の詳細分類に使用するキーワード配列。カテゴリ（大分類）に対し、タグは多次元の詳細分類を提供 |
| OGP | Open Graph Protocol | SNSシェア時に表示されるメタデータの規格 |
| OGP Image | OGP画像 | SNSシェア時に表示される記事固有の画像。1200x630pxのPNG形式 |
| Satori | Satori | Edge環境で動作するHTML/CSSからSVG/PNG画像を生成するライブラリ |
| Filter | フィルタ | ユーザーが指定した条件に基づいて記事一覧を絞り込む機能 |
| Filter Panel | フィルタパネル | カテゴリとタグを選択するためのUIコンポーネント |
| Tag Group | タググループ | タグを技術領域（Remix, Cloudflare, Claude Code）ごとに分類したグループ。フィルタパネルでグループ別に表示し、UXとコンテンツの発見性を向上させる |
| Query Parameter | クエリパラメータ | URLの`?category=...&tags=...`のようなパラメータ。フィルタ状態を永続化する |

---

## 5. テスト戦略

**層別テスト方針**:
- **UI層**: Playwrightによるブラウザテスト（`tests/e2e/`）
  - ユーザーインタラクションの検証
  - ページ遷移、フォーム送信、表示内容の確認
- **純粋ロジック層**: Vitestによる単体テスト（`tests/unit/`）
  - 入出力の検証（副作用なし）
  - エッジケース、境界値テスト
- **副作用層**: モック化したVitestテスト（`tests/integration/`）
  - 外部API、DB操作のモック検証
  - エラーハンドリングの確認

**カバレッジ目標**:
- **純粋ロジック層（lib）**: 80%以上のラインカバレッジ（マークダウン変換処理など重要ロジックは100%を目指す）
- **副作用層（data-io）**: モックを用いた主要パスのカバレッジ70%以上

**テストデータ**:
- **配置場所**: `develop/blog/{section}/spec.yaml`
- **管理方針**: 実装とテストの値（定数、メッセージテキスト、テストデータ）はspec.yamlで一元管理する
- **モックデータの方針**:
  - サンプル記事データはマークダウンファイル形式で提供
  - 記事メタデータ（タイトル、投稿日、著者など）はspec.yaml内で定義

---

## 6. エラーハンドリングと例外処理

**エラー境界**:
- **Route層**: Remixの `CatchBoundary` / `ErrorBoundary` を使用
  - データ取得失敗時のフォールバック戦略を明記
  - ユーザーに表示するエラーメッセージの方針
- **Component層**: エラー状態の表示方法（例: ローディング、エラーメッセージ）

**meta関数のフォールバック戦略**:
- `description`が存在しない場合: `title`を`description`として使用
- `data`が存在しない場合（404エラー等）: 空の配列`[]`を返す
- OGP画像が指定されていない場合: デフォルトのOGP画像を使用（設定されている場合）

**ユーザー通知**:
- **エラーメッセージの表示方法**: [例: トースト通知、インライン表示、モーダル]
- **ログ出力ポリシー**: [例: 本番環境ではconsole.errorを使用、開発環境では詳細スタックトレース]

---

## 7. 命名規約

**ファイル命名**:
- **コンポーネント**: PascalCase（例: `RetryModal.tsx`）
- **ロジック**: camelCase（例: `calculateRetryTarget.ts`）
- **定数ファイル**: camelCase（例: `constants.ts`）
- **サーバー専用ファイル**: `.server.ts` サフィックスを付与（例: `archiveFiles.server.ts`）

**変数・関数命名**:
- **変数**: camelCase（例: `userName`, `isActive`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）
- **関数**: camelCase、動詞で始める（例: `calculateTotal`, `fetchUserData`）
- **型・インターフェース**: PascalCase（例: `UserProfile`, `ApiResponse`）

**プロジェクト固有の命名パターン**:
- **Routeファイル**: Flat Routes規則に従う
  - インデックス: `app/routes/blog._index.tsx` → `/blog`
  - 動的ルート: `app/routes/blog.$slug.tsx` → `/blog/:slug`
- **Componentディレクトリ**: `app/components/blog/<section>/`
- **Libディレクトリ**: `app/lib/blog/<section>/`
- **Data-IOディレクトリ**: `app/data-io/blog/<section>/`

---

## 8. ドキュメント完了条件（Definition of Done）

このドキュメントを含む各設計ドキュメントは、以下の条件を満たした時点で完了とみなします：

1. ✅ **リント検証の合格**: `node scripts/lint-template/engine.js` が0件の違反を報告
2. ✅ **必須項目の記載**: テンプレートの`[例: ...]`や`[記述してください]`などのプレースホルダーがすべて実際の内容に置換されている
3. ✅ **用語の一貫性**: 用語集（セクション4）に定義された用語が本文中で一貫して使用されている
4. ✅ **依存ドキュメントとの整合性**: `CLAUDE.md`や`README.md`で定義された原則に矛盾がない
5. ✅ **アーキテクチャ原則の遵守**: 3大層分離、スタイリング憲章などの原則が明示的に反映されている

---

## 9. ドキュメント間の優先順位

設計判断や実装方針に矛盾が生じた場合、以下の優先順位に従います：

1. **最優先**: [`CLAUDE.md`](../../../../CLAUDE.md) - プロジェクト全体のマスタールール
2. **第2優先**: 本ドキュメント (`GUIDING_PRINCIPLES.md`) - サービス固有の方針
3. **第3優先**: [`func-spec.md`](func-spec.md), [`uiux-spec.md`](uiux-spec.md) - 機能詳細仕様
4. **参考**: [`spec.yaml`](spec.yaml), [`file-list.md`](file-list.md) - 実装詳細

**重要**: 上位のドキュメントに記載されていない事項について、下位のドキュメントで独自に定義することは許可されます。しかし、上位のドキュメントと矛盾する定義は禁止されます。
