# {{service}} サービス開発原則 (GUIDING_PRINCIPLES)

## 1. 目的とスコープ

このドキュメントは、`{{service}}` サービス開発における技術的な方針、アーキテクチャ原則、および品質基準を定義します。
以降のすべての設計ドキュメント（`func-spec.md`, `uiux-spec.md` など）は、この原則に従って作成されなければなりません。

### 1.1. サービス概要

- **目的**: [このサービスが解決する課題や目的を簡潔に記述。例: 「開発フローの進捗を可視化し、手戻りを防ぐ」]
- **主要機能**: [このサービスが提供する主要な機能を箇条書きで記述]
- **ターゲットユーザー**: [想定するユーザー層を記載。例: AIエージェント、人間開発者]

### 1.2. 開発スコープ

- **範囲内 (In Scope)**: [今回のMVP開発で実装する範囲を明確に記述]
- **範囲外 (Out of Scope)**: [将来的な拡張や、今回実装しない機能を明記。例: 「リアルタイム更新機能」「ユーザー認証」]

---

## 2. 遵守すべきアーキテクチャ原則

このサービスは、プロジェクトのボイラープレートで定義された以下の主要なアーキテクチャ原則を厳格に遵守します。詳細な規約については、各ドキュメントを参照してください。

- **3大層分離アーキテクチャ**: `CLAUDE.md` および `README.md` に記載の通り、UI層・純粋ロジック層・副作用層の責務を分離します。
- **Outside-In TDD**: `TDD_WORK_FLOW.md` に記載された開発フローに従います。
- **スタイリング憲章**: `docs/CSS_structure/STYLING_CHARTER.md` に基づくCSS階層アーキテクチャを遵守します。

---

## 3. セクション間連携と共通化方針

### 3.1. セクション定義

[このサービスを構成するセクションをリストアップし、それぞれの役割を簡潔に記述]

- **`common`**: [例: サービス全体で共有されるヘッダー、フッター、レイアウトコンポーネント]
- **`design-flow`**: [例: 設計フローの監査機能を提供するセクション]
- **`implementation-flow`**: [例: 実装フローの監査機能を提供するセクション]

### 3.2. 共通コンポーネントの配置ルール

**基本方針**: サービス内共通コンポーネントは `app/components/{{service}}/common/` に配置します。

**プロジェクト共通コンポーネント**: プロジェクト全体で利用されるコンポーネントは、オペレーターに相談の上、適切な場所に配置する。

#### file-list.md管理方針

複数セクションで共有されるコンポーネントは、commonセクションのfile-list.mdに記載します：

### 3.3. 実装順序

**重要**: `common`セクションは、他のセクションよりも**必ず先に実装**してください。他のセクションが共通コンポーネントに依存する可能性があるためです。

### 3.4. データフロー

[セクション間の主要なデータフローや、Remixの `loader`/`action` を通じたデータの流れを記述。必要であればMermaid図を使用]

---

## 4. 用語集 (Glossary)

このサービス開発で使用される主要な用語、英単語の日本語訳、および略語の定義を以下に示します。一貫したコミュニケーションと実装のために、これらの定義に従ってください。

| 用語 (Term) | 定義・翻訳 (Definition/Translation) | 備考・使用例 (Notes/Examples) |
|:---|:---|:---|
| [用語を記述] | [用語の定義や翻訳を記述] | [使用例や補足事項を記述] |
| Checkpoint | 開発フローにおける個々の確認項目。ファイルの存在有無などをトリガーとする監査ポイント。 | 例: `func-spec.md` の存在確認 |
| Section | サービスを構成する機能単位。 | 例: `common`, `design-flow` |

---

## 5. テスト戦略

### 5.1. 層別テスト方針

- **UI層**: Playwrightによるブラウザテスト（`tests/e2e/`）
  - ユーザーインタラクションの検証
  - ページ遷移、フォーム送信、表示内容の確認
- **純粋ロジック層**: Vitestによる単体テスト（`tests/unit/`）
  - 入出力の検証（副作用なし）
  - エッジケース、境界値テスト
- **副作用層**: モック化したVitestテスト（`tests/integration/`）
  - 外部API、DB操作のモック検証
  - エラーハンドリングの確認

### 5.2. カバレッジ目標

- [必要に応じてカバレッジ基準を記載。例: ビジネスロジック層は80%以上]

### 5.3. テストデータ

- [テストデータの配置場所やモックデータの方針を記載。例: `tests/fixtures/` 配下に配置]

---

## 6. エラーハンドリングと例外処理

### 6.1. エラー境界

- **Route層**: Remixの `CatchBoundary` / `ErrorBoundary` を使用
  - データ取得失敗時のフォールバック戦略を明記
  - ユーザーに表示するエラーメッセージの方針
- **Component層**: エラー状態の表示方法（例: ローディング、エラーメッセージ）

### 6.2. ユーザー通知

- **エラーメッセージの表示方法**: [例: トースト通知、インライン表示、モーダル]
- **ログ出力ポリシー**: [例: 本番環境ではconsole.errorを使用、開発環境では詳細スタックトレース]

---

## 7. 命名規約

### 7.1. ファイル命名

- **コンポーネント**: PascalCase（例: `RetryModal.tsx`）
- **ロジック**: camelCase（例: `calculateRetryTarget.ts`）
- **定数ファイル**: camelCase（例: `constants.ts`）
- **サーバー専用ファイル**: `.server.ts` サフィックスを付与（例: `archiveFiles.server.ts`）

### 7.2. 変数・関数命名

- **変数**: camelCase（例: `userName`, `isActive`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）
- **関数**: camelCase、動詞で始める（例: `calculateTotal`, `fetchUserData`）
- **型・インターフェース**: PascalCase（例: `UserProfile`, `ApiResponse`）

### 7.3. プロジェクト固有の命名パターン

- [必要に応じて、プロジェクト独自の命名ルールを記載]

---

## 8. ドキュメント完了条件（Definition of Done）

このドキュメントを含む各設計ドキュメントは、以下の条件を満たした時点で完了とみなします：

1. ✅ **リント検証の合格**: `node scripts/lint-template/engine.js` が0件の違反を報告
2. ✅ **必須項目の記載**: テンプレートの`[例: ...]`や`[記述してください]`などのプレースホルダーがすべて実際の内容に置換されている
3. ✅ **用語の一貫性**: 用語集（セクション4）に定義された用語が本文中で一貫して使用されている
4. ✅ **依存ドキュメントとの整合性**: `CLAUDE.md`や`README.md`で定義された原則に矛盾がない
5. ✅ **アーキテクチャ原則の遵守**: 3大層分離、スタイリング憲章などの原則が明示的に反映されている

---

## 9. ドキュメント間の優先順位

設計判断や実装方針に矛盾が生じた場合、以下の優先順位に従います：

1. **最優先**: [`CLAUDE.md`](../../../../CLAUDE.md) - プロジェクト全体のマスタールール
2. **第2優先**: 本ドキュメント (`GUIDING_PRINCIPLES.md`) - サービス固有の方針
3. **第3優先**: [`func-spec.md`](func-spec.md), [`uiux-spec.md`](uiux-spec.md) - 機能詳細仕様
4. **参考**: [`spec.yaml`](spec.yaml), [`file-list.md`](file-list.md) - 実装詳細

**重要**: 上位のドキュメントに記載されていない事項について、下位のドキュメントで独自に定義することは許可されます。しかし、上位のドキュメントと矛盾する定義は禁止されます。
