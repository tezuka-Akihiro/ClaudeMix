# 【機能修正提案】ブログフッターのリーガルページ取り下げ

- **サービス**: `blog`
- **セクション**: `common`, `landing`
- **関連ドキュメント**:
  - `app/specs/blog/common-spec.yaml`
  - `app/specs/blog/landing-spec.yaml`
  - `app/components/blog/common/BlogFooter.tsx`
  - `app/components/blog/landing/LandingFooter.tsx`
  - `app/routes/blog.landing.$target.tsx`

---

## 1. 提案概要

ブログサービスの共通設定（common-spec.yaml）からリーガルページ関連の設定を削除し、ランディングページ（landing-spec.yaml）に一元化します。

## 2. 変更内容 (As-Is / To-Be)

### 現状 (As-Is)

- `app/specs/blog/common-spec.yaml`の`footer`セクションに以下が定義されている：
  - `legal_links`: 利用規約、プライバシーポリシー、特定商取引法に基づく表記のリンク設定
  - `legal_content`: 特定商取引法のモーダル表示用コンテンツ（HTML形式）
- `app/routes/blog.landing.$target.tsx`のloaderで、`commonSpec.footer.legal_content`を取得
- ランディングページのフッターリンクは、route内でハードコード（102-106行目）
- BlogFooterコンポーネントは、footerLinksとlegalContentをpropsとして受け取る設計

### 修正後 (To-Be)

- `app/specs/blog/common-spec.yaml`から以下を削除：
  - `footer.legal_links`（54-64行目）
  - `footer.legal_content`（66-125行目）
  - `ui_selectors.legal_modal`（153-157行目）
  - `accessibility.aria_labels.legal_modal_close`（181行目）
  - `accessibility.keyboard_shortcuts.close_modal`（185行目）
- `app/specs/blog/landing-spec.yaml`に以下を追加：
  - `footer.legal_links`: リーガルリンク設定
  - `footer.legal_content`: 特定商取引法のモーダルコンテンツ
- `app/routes/blog.landing.$target.tsx`を修正：
  - ハードコードされたfooterLinksを削除
  - landing-spec.yamlから`footer.legal_links`を取得
  - landing-spec.yamlから`footer.legal_content`を取得（commonSpecではなく）
- BlogFooterコンポーネントの使用状況を確認し、影響範囲を特定

## 3. 背景・目的

### 背景

リーガルページ（利用規約、プライバシーポリシー、特定商取引法）は、ブログサービス全体で共通の要素として`common-spec.yaml`に定義されていましたが、実際にはランディングページでのみ使用されています。このため、設定が適切な場所に配置されていない状態です。

### 目的

- **目的1**: 設定の適切な配置 - ランディングページ固有の設定は`landing-spec.yaml`に配置することで、責務を明確化
- **目的2**: common-spec.yamlのスリム化 - 実際に共通で使用されていない設定を削除し、保守性を向上
- **目的3**: SSoT原則の徹底 - ハードコードされたfooterLinksをspec.yamlに移行し、単一真実の源を維持

## 4. 変更の妥当性 (Pros / Cons)

`@ArchitectureGuardian` の視点に基づき、この変更がプロジェクトの設計思想に合致するかを評価します。

Pros (利点):

- SSoT原則の徹底 - ハードコードされた値をspec.yamlに移行し、設定の一元管理を実現
- 責務の明確化 - ランディングページ固有の設定は`landing-spec.yaml`に配置することで、各specファイルの役割が明確化
- 保守性の向上 - common-spec.yamlから使用されていない設定を削除し、ファイルがスリム化
- 認知負荷の軽減 - 開発者が設定を探す際に、適切な場所（landing-spec.yaml）を確認すればよい

Cons (懸念点):

- BlogFooterコンポーネントへの影響 - 他のページでBlogFooterが使用されている場合、修正が必要になる可能性
- マイグレーション作業 - common-spec.yamlからlanding-spec.yamlへの設定移行と、関連コードの修正が必要

**総合評価**:

この変更は、ClaudeMixのコア原則である「SSoT原則」と「3層specアーキテクチャ（shared / common / section）」を強化するものです。リーガルページ設定がランディングページでのみ使用されている現状を考慮すると、`landing-spec.yaml`への移行は**非常に妥当性が高い**と判断します。Consとして挙げた懸念点も、影響範囲の調査と適切なマイグレーション手順により解決可能です。

## 5. 設計フロー

以下の設計ドキュメントを上から順に確認し、編集内容を記載します。

### 🗾GUIDING_PRINCIPLES.md

**対象**: `develop/blog/GUIDING_PRINCIPLES.md`

**編集内容**: 編集不要（アーキテクチャ原則に変更なし）

### 📚️func-spec.md

#### common/func-spec.md

**対象**: `develop/blog/common/func-spec.md`

**編集内容**:
- BlogFooterとLegalModalの説明から、リーガルリンク関連の記述を削除
- BlogFooterは「コピーライト表示のみ」に簡素化されたことを明記

#### landing/func-spec.md

**対象**: `develop/blog/landing/func-spec.md`

**編集内容**:
- フッター機能の説明を追加
  - リーガルリンク（利用規約、プライバシーポリシー、特定商取引法）の表示
  - LegalModalの使用（特定商取引法のモーダル表示）
  - SEO対策の説明

### 🖼️uiux-spec.md

#### common/uiux-spec.md

**対象**: `develop/blog/common/uiux-spec.md`

**編集内容**:
- BlogFooterのUI仕様から、リーガルリンク関連の記述を削除
- LegalModalの仕様セクションを削除

#### landing/uiux-spec.md

**対象**: `develop/blog/landing/uiux-spec.md`

**編集内容**:
- LandingFooterのUI仕様を追加
  - リーガルリンクのレイアウト
  - LegalModalの表示仕様
  - アクセシビリティ要件

### 📋️spec.yaml

#### app/specs/blog/common-spec.yaml

**編集内容**:
- `footer.legal_links`を削除（54-64行目）
- `footer.legal_content`を削除（66-125行目）
- `ui_selectors.legal_modal`を削除（153-157行目）
- `accessibility.aria_labels.legal_modal_close`を削除（181行目）
- `accessibility.keyboard_shortcuts.close_modal`を削除（185行目）

#### app/specs/blog/landing-spec.yaml

**編集内容**:
- `footer`セクションを新規追加：
  ```yaml
  footer:
    legal_links:
      - label: "利用規約"
        href: "/blog/terms"
        is_modal: false
      - label: "プライバシーポリシー"
        href: "/blog/privacy"
        is_modal: false
      - label: "特定商取引法に基づく表記"
        is_modal: true
    legal_content: |
      [common-spec.yamlから移行]
  ```
- `ui_selectors`セクションに`legal_modal`を追加
- `accessibility.aria_labels`に`legal_modal_close`を追加
- `accessibility.keyboard_shortcuts`に`close_modal`を追加

#### app/specs/blog/types.ts

**編集内容**:
- `BlogCommonSpec`の`footer`型定義を修正：
  - `legal_links`プロパティを削除
  - `legal_content`プロパティを削除
- `BlogLandingSpec`に`footer`型定義を追加：
  ```typescript
  footer: {
    legal_links: Array<{
      label: string;
      href?: string;
      is_modal: boolean;
    }>;
    legal_content: string;
  };
  ```

### 🗂️file_list.md

#### common/file_list.md

**対象**: `develop/blog/common/file-list.md`

**編集内容**:
- BlogFooterとLegalModalの説明を更新（リーガルリンク機能を削除）
- loadBlogConfig.server.tsの説明を更新（footerLinks/legalContent処理を削除）

#### landing/file_list.md

**対象**: `develop/blog/landing/file-list.md`

**編集内容**: 編集不要（既存ファイルのみ使用）

### 🧬data-flow-diagram.md

#### common/data-flow-diagram.md

**対象**: `develop/blog/common/data-flow-diagram.md`

**編集内容**:
- loadBlogConfigのデータフロー図を更新
  - footerLinks/legalContentの処理フローを削除
  - BlogConfigの型定義を更新（footerLinks/legalContentプロパティ削除）

#### landing/data-flow-diagram.md

**対象**: `develop/blog/landing/data-flow-diagram.md`

**編集内容**:
- loaderのデータフロー図を更新
  - landing-spec.yamlからfooter設定を取得する処理を追加
  - LandingFooterへのデータフローを追加

## 6. TDD_WORK_FLOW.md 簡易版

以下の全項目に対して、実際のパスと編集内容を1行で記載します。

### 👁️e2e-screen-test

**パス**: `tests/e2e/screen/blog-landing.spec.ts`

**編集内容**: ランディングページのフッターリンクとLegalModal表示のテストケースを追加

### 👁️e2e-section-test

**編集内容**: 該当なし（セクションレベルのテスト不要）

### 🎨CSS実装 (layer2.css, layer3.ts, layer4.ts)

**編集内容**: 変更なし（既存のBlogFooter/LegalModalのスタイルを使用）

### 🪨route

**パス**: `app/routes/blog.landing.$target.tsx`

**編集内容**: loaderでlanding-spec.yamlからfooter設定を取得、ハードコードされたfooterLinksを削除（102-106行目）

### 🚧components.test

**パス**: `app/components/blog/common/BlogFooter.test.tsx`

**編集内容**: footerLinks/legalContentを使用するテストケースを削除または修正

### 🪨components

**パス**:
- `app/components/blog/common/BlogFooter.tsx` - footerLinks/legalContent propsを削除、コピーライトのみ表示
- `app/components/blog/common/BlogLayout.tsx` - BlogFooterへのfooterLinks/legalContent渡しを削除
- `app/components/blog/landing/LandingFooter.tsx` - 変更なし（既にLegalModal使用）

### 🚧logic.test

**編集内容**: 該当なし（ロジック層の変更なし）

### 🪨logic

**編集内容**: 該当なし（ロジック層の変更なし）

### 🚧data-io.test

**パス**: `app/data-io/blog/common/loadBlogConfig.server.test.ts`

**編集内容**: footerLinks/legalContentのテストケースを削除

### 🪨data-io

**パス**: `app/data-io/blog/common/loadBlogConfig.server.ts`

**編集内容**: footerLinks/legalContentの処理ロジックを削除（21-29行目、41-42行目）、BlogConfig型からfooterLinks/legalContentを削除

### その他

**パス**:
- `app/routes/blog._index.tsx` - loadBlogConfigの戻り値変更に対応（BlogLayoutへの渡し方を修正）
- `app/routes/blog.$slug.tsx` - loadBlogConfigの戻り値変更に対応（BlogLayoutへの渡し方を修正）
- `app/specs/blog/types.ts` - BlogConfig型からfooterLinks/legalContentを削除

**設計ドキュメント更新**:
- `develop/blog/common/func-spec.md` - BlogFooter/LegalModalの説明更新
- `develop/blog/common/uiux-spec.md` - BlogFooter/LegalModalのUI仕様更新
- `develop/blog/common/file-list.md` - 影響ファイルの説明更新
- `develop/blog/common/data-flow-diagram.md` - データフロー図更新
- `develop/blog/landing/func-spec.md` - フッター機能の説明追加
- `develop/blog/landing/uiux-spec.md` - LandingFooterのUI仕様追加
- `develop/blog/landing/data-flow-diagram.md` - データフロー図更新
