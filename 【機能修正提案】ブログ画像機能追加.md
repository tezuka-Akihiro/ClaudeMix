# ã€æ©Ÿèƒ½ä¿®æ­£ææ¡ˆã€‘ãƒ–ãƒ­ã‚°ç”»åƒæ©Ÿèƒ½è¿½åŠ ï¼ˆR2é€£æºï¼‰

- **ã‚µãƒ¼ãƒ“ã‚¹**: `blog`
- **ã‚»ã‚¯ã‚·ãƒ§ãƒ³**: `posts`, `post-detail`, `common`ï¼ˆè¤‡æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é–¢ä¸ï¼‰
- **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
  - `develop/blog/posts/func-spec.md`
  - `develop/blog/post-detail/func-spec.md`
  - `develop/blog/common/func-spec.md`
  - `app/specs/blog/posts-spec.yaml`
  - `app/specs/blog/post-detail-spec.yaml`
  - `app/specs/blog/common-spec.yaml`

---

## 1. ææ¡ˆæ¦‚è¦

Cloudflare R2ã§ç®¡ç†ã•ã‚Œã‚‹ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒï¼ˆWebPå½¢å¼ï¼‰ã‚’ãƒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã«çµ±åˆã—ã€è¨˜äº‹ä¸€è¦§ãƒ»è¨˜äº‹è©³ç´°ãƒ»OGPç”»åƒç”Ÿæˆã§åˆ©ç”¨å¯èƒ½ã«ã—ã¾ã™ã€‚

## 2. å¤‰æ›´å†…å®¹ (As-Is / To-Be)

### ç¾çŠ¶ (As-Is)

- **è¨˜äº‹ä¸€è¦§ï¼ˆpostsï¼‰**: ã‚¿ã‚¤ãƒˆãƒ«ã€æ—¥ä»˜ã€ã‚«ãƒ†ã‚´ãƒªã€ã‚¿ã‚°ã®ã¿è¡¨ç¤ºã€‚ç”»åƒãªã—ã€‚
- **è¨˜äº‹è©³ç´°ï¼ˆpost-detailï¼‰**: ã‚¿ã‚¤ãƒˆãƒ«ã€æœ¬æ–‡ã®ã¿ã€‚ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒãªã—ã€‚
- **OGPï¼ˆcommonï¼‰**: ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã®å‹•çš„OGPç”»åƒç”Ÿæˆã€‚ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ ãƒã‚¤ãƒ«æœªå¯¾å¿œã€‚
- **å‹å®šç¾©**: `Post`å‹ã€`PostSummary`å‹ã«`thumbnail`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã—ã€‚
- **ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼**: `thumbnail`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æœªå®šç¾©ã€‚

### ä¿®æ­£å¾Œ (To-Be)

- **è¨˜äº‹ä¸€è¦§ï¼ˆpostsï¼‰**: å„è¨˜äº‹ã‚«ãƒ¼ãƒ‰ã«ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã‚’è¡¨ç¤ºï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã€‚
- **è¨˜äº‹è©³ç´°ï¼ˆpost-detailï¼‰**: è¨˜äº‹å†’é ­ã«ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã‚’è¡¨ç¤ºï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã€‚
- **OGPï¼ˆcommonï¼‰**: ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ ãƒã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã€ãªã„å ´åˆã¯å¾“æ¥ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹OGPã€‚
- **å‹å®šç¾©**: `Post`å‹ã€`PostSummary`å‹ã«`thumbnail?: string`ã‚’è¿½åŠ ã€‚
- **ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼**: `thumbnail`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ï¼ˆä»»æ„é …ç›®ï¼‰ã€‚

### R2ç”»åƒä»•æ§˜

| é …ç›® | å€¤ |
|------|-----|
| ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | WebP (.webp) |
| è§£åƒåº¦ | 1200 Ã— 630 px |
| ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” | 1.91 : 1 |
| ãƒ•ã‚¡ã‚¤ãƒ«å | thumbnail.webp |
| ç›®æ¨™å®¹é‡ | 100KBä»¥ä¸‹ |
| å“è³ªè¨­å®š | 75% ã€œ 80% |

### R2 URLæ§‹é€ 

```
https://assets.claudemix.dev/blog/{year}/{month}/{slug}/thumbnail.webp
```

ä¾‹: `https://assets.claudemix.dev/blog/2026/01/stripe-integration/thumbnail.webp`

### ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è¨˜æ³•

```yaml
---
title: "è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«"
thumbnail: "2026/01/stripe-integration/thumbnail.webp"
# ã¾ãŸã¯å®Œå…¨URL
thumbnail: "https://assets.claudemix.dev/blog/2026/01/stripe-integration/thumbnail.webp"
---
```

**æ³¨**: `thumbnail`ã¯ä»»æ„é …ç›®ã€‚æœªæŒ‡å®šã®å ´åˆã¯`null`/`undefined`ã¨ã—ã¦æ‰±ã†ã€‚

## 3. èƒŒæ™¯ãƒ»ç›®çš„

### èƒŒæ™¯

- SNSã§ã®ã‚·ã‚§ã‚¢æ™‚ã«è¦–è¦šçš„ãªè¨´æ±‚åŠ›ãŒä¸è¶³ã—ã¦ã„ã‚‹
- è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸ãŒãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã§è¦–è¦šçš„ãªåŒºåˆ¥ãŒã¤ãã«ãã„
- R2ã¯æ—¢ã«Cloudflareç’°å¢ƒã§åˆ©ç”¨å¯èƒ½ã§ã‚ã‚Šã€ç”»åƒé…ä¿¡ã«æœ€é©

### ç›®çš„

- **ç›®çš„1**: SNSã‚·ã‚§ã‚¢æ™‚ã®è¦–è¦šçš„è¨´æ±‚åŠ›å‘ä¸Šï¼ˆã‚«ã‚¹ã‚¿ãƒ OGPç”»åƒï¼‰
- **ç›®çš„2**: è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸ã®UXå‘ä¸Šï¼ˆã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºã«ã‚ˆã‚‹è¦–èªæ€§å‘ä¸Šï¼‰
- **ç›®çš„3**: è¨˜äº‹è©³ç´°ãƒšãƒ¼ã‚¸ã®è¡¨ç¾åŠ›å‘ä¸Šï¼ˆã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒç”»åƒï¼‰
- **ç›®çš„4**: R2ã«ã‚ˆã‚‹ç”»åƒã‚¢ã‚»ãƒƒãƒˆç®¡ç†ã®ä¸€å…ƒåŒ–

## 4. å¤‰æ›´ã®å¦¥å½“æ€§ (Pros / Cons)

### Pros (åˆ©ç‚¹)

- **SNSè¨´æ±‚åŠ›å‘ä¸Š**: ã‚«ã‚¹ã‚¿ãƒ OGPç”»åƒã«ã‚ˆã‚Šã€ã‚·ã‚§ã‚¢æ™‚ã®ã‚¯ãƒªãƒƒã‚¯ç‡å‘ä¸ŠãŒæœŸå¾…ã§ãã‚‹
- **UXæ”¹å–„**: è¨˜äº‹ä¸€è¦§ãƒ»è©³ç´°ãƒšãƒ¼ã‚¸ã®è¦–è¦šçš„ãªé­…åŠ›å‘ä¸Š
- **æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©æ´»ç”¨**: Cloudflare R2ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚è¿½åŠ ã‚³ã‚¹ãƒˆãŒæœ€å°é™
- **å¾Œæ–¹äº’æ›æ€§**: `thumbnail`ã¯ä»»æ„é …ç›®ã®ãŸã‚ã€æ—¢å­˜è¨˜äº‹ã¸ã®å½±éŸ¿ãªã—
- **çµ±ä¸€URLæ§‹é€ **: æ—¥ä»˜+ã‚¹ãƒ©ã‚°ã«ã‚ˆã‚‹äºˆæ¸¬å¯èƒ½ãªURLè¨­è¨ˆ

### Cons (æ‡¸å¿µç‚¹)

- **è¤‡æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®å¤‰æ›´**: posts, post-detail, commonã®3ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å¤‰æ›´ãŒåŠã¶
- **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é‹ç”¨**: R2ã¸ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯åˆ¥é€”æ‰‹å‹•/ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¯¾å¿œãŒå¿…è¦
- **å‹å®šç¾©ã®å¤‰æ›´**: æ—¢å­˜ã®å‹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§

### ç·åˆè©•ä¾¡

Consã¯å­˜åœ¨ã™ã‚‹ã‚‚ã®ã®ã€ã„ãšã‚Œã‚‚ç®¡ç†å¯èƒ½ãªç¯„å›²å†…ã§ã™ã€‚ç‰¹ã«`thumbnail`ã‚’ä»»æ„é …ç›®ã¨ã™ã‚‹ã“ã¨ã§å¾Œæ–¹äº’æ›æ€§ã‚’æ‹…ä¿ã—ã¦ãŠã‚Šã€æ®µéšçš„ãªç§»è¡ŒãŒå¯èƒ½ã§ã™ã€‚SNSè¨´æ±‚åŠ›ã¨UXå‘ä¸Šã¨ã„ã†æ˜ç¢ºãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ãŸã‚ã€ã“ã®å¤‰æ›´ã¯**å¦¥å½“æ€§ãŒé«˜ã„**ã¨åˆ¤æ–­ã—ã¾ã™ã€‚

---

## 5 è¨­è¨ˆãƒ•ãƒ­ãƒ¼

ä»¥ä¸‹ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¸Šã‹ã‚‰é †ã«ç¢ºèªã—ã€ç·¨é›†å†…å®¹ã‚’è¿½è¨˜ã€‚

### ğŸ—¾GUIDING_PRINCIPLES.md

å¤‰æ›´ãªã—ï¼ˆåŸå‰‡ã¸ã®å½±éŸ¿ãªã—ï¼‰

### ğŸ“šï¸func-spec.md

#### blog/posts/func-spec.md
- PostSummaryã«ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºæ©Ÿèƒ½ã‚’è¿½åŠ 
- ã‚µãƒ ãƒã‚¤ãƒ«æœªè¨­å®šæ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’å®šç¾©

#### blog/post-detail/func-spec.md
- è¨˜äº‹è©³ç´°ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºæ©Ÿèƒ½ã‚’è¿½åŠ 
- ã‚µãƒ ãƒã‚¤ãƒ«æœªè¨­å®šæ™‚ã®å‹•ä½œï¼ˆéè¡¨ç¤ºï¼‰ã‚’å®šç¾©

#### blog/common/func-spec.md
- OGPç”»åƒç”Ÿæˆæ™‚ã®ã‚µãƒ ãƒã‚¤ãƒ«åˆ©ç”¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
- ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ ãƒã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ç›´æ¥URLã‚’è¿”ã™

### ğŸ–¼ï¸uiux-spec.md

#### blog/posts/uiux-spec.md
- PostCardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒè¡¨ç¤ºé ˜åŸŸã‚’è¿½åŠ 
- ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”1.91:1ã®ç”»åƒã‚³ãƒ³ãƒ†ãƒŠä»•æ§˜

#### blog/post-detail/uiux-spec.md
- ArticleHeaderã«ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒè¡¨ç¤ºã‚’è¿½åŠ 
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®ç”»åƒè¡¨ç¤ºä»•æ§˜

### ğŸ“‹ï¸spec.yaml

#### blog/posts-spec.yaml
- `frontmatter_fields`ã«`thumbnail`ã‚’è¿½åŠ 
- R2ç”»åƒè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

#### blog/post-detail-spec.yaml
- ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºè¨­å®šã‚’è¿½åŠ 

#### blog/common-spec.yaml
- OGPã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚µãƒ ãƒã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®šã‚’è¿½åŠ 
- R2ã‚¢ã‚»ãƒƒãƒˆãƒ™ãƒ¼ã‚¹URLè¨­å®šã‚’è¿½åŠ 

### ğŸ—‚ï¸file_list.md

å¤‰æ›´ãªã—ï¼ˆæ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ ãªã—ã€æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£ã®ã¿ï¼‰

### ğŸ§¬data-flow-diagram.md

#### blog/posts/data-flow-diagram.md
- PostSummaryã«thumbnailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æµã‚Œã‚’è¿½åŠ 

#### blog/post-detail/data-flow-diagram.md
- Postã«thumbnailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æµã‚Œã‚’è¿½åŠ 

---

## 6 TDD_WORK_FLOW.md ç°¡æ˜“ç‰ˆ

### ğŸ‘ï¸e2e-screen-test

- `tests/e2e/blog/posts.spec.ts` - ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºç¢ºèªãƒ†ã‚¹ãƒˆè¿½åŠ 
- `tests/e2e/blog/post-detail.spec.ts` - ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºç¢ºèªãƒ†ã‚¹ãƒˆè¿½åŠ 

### ğŸ‘ï¸e2e-section-test

å¤‰æ›´ãªã—

### ğŸ¨CSSå®Ÿè£… (layer2.css, layer3.ts, layer4.ts)

- `app/styles/layer2-sections/blog.css` - ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 

### ğŸª¨route

- `app/routes/blog._index.tsx` - thumbnailã‚’loaderã‹ã‚‰è¿”å´
- `app/routes/blog.$slug.tsx` - thumbnailã‚’loaderã‹ã‚‰è¿”å´
- `app/routes/blog.$slug.ogp[.png].tsx` - ã‚µãƒ ãƒã‚¤ãƒ«å¯¾å¿œãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 

### ğŸš§components.test

- `app/components/blog/posts/PostCard.test.tsx` - ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆè¿½åŠ 
- `app/components/blog/post-detail/ArticleHeader.test.tsx` - ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆè¿½åŠ 

### ğŸª¨components

- `app/components/blog/posts/PostCard.tsx` - ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒè¡¨ç¤ºè¿½åŠ 
- `app/components/blog/post-detail/ArticleHeader.tsx` - ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒè¡¨ç¤ºè¿½åŠ 

### ğŸš§logic.test

å¤‰æ›´ãªã—ï¼ˆãƒ­ã‚¸ãƒƒã‚¯å±¤ã¯ç”»åƒURLã®çµ„ã¿ç«‹ã¦ã®ã¿ï¼‰

### ğŸª¨logic

å¤‰æ›´ãªã—

### ğŸš§data-io.test

- `app/data-io/blog/posts/fetchPosts.server.test.ts` - thumbnailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ãƒ†ã‚¹ãƒˆ
- `app/data-io/blog/post-detail/fetchPostBySlug.server.test.ts` - thumbnailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ãƒ†ã‚¹ãƒˆ
- `app/data-io/blog/common/loadPostMetadata.server.test.ts` - thumbnailè¿½åŠ ãƒ†ã‚¹ãƒˆ

### ğŸª¨data-io

- `app/data-io/blog/posts/fetchPosts.server.ts` - thumbnailã‚’PostSummaryã«è¿½åŠ 
- `app/data-io/blog/post-detail/fetchPostBySlug.server.ts` - thumbnailã‚’è¿”å´
- `app/data-io/blog/common/loadPostMetadata.server.ts` - thumbnailè¿½åŠ 

### ãã®ä»–

- `app/specs/blog/types.ts` - Postå‹ã€PostSummaryå‹ã«thumbnailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- `scripts/prebuild-blog.ts` - frontmatterã‹ã‚‰thumbnailèª­ã¿è¾¼ã¿å¯¾å¿œï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰

---

## ç¢ºèªäº‹é …

Phase 1å®Œäº†ã€‚ä»¥ä¸‹ã«ã¤ã„ã¦ã”ç¢ºèªãã ã•ã„ï¼š

1. **ææ¡ˆæ¦‚è¦**: æ„å›³ã¨åˆã£ã¦ã„ã‚‹ã‹
2. **As-Is / To-Be**: èªè­˜ã«é½Ÿé½¬ãŒãªã„ã‹
3. **R2 URLæ§‹é€ **: `https://assets.claudemix.dev/blog/{year}/{month}/{slug}/thumbnail.webp` ã§å•é¡Œãªã„ã‹
4. **ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼è¨˜æ³•**: ç›¸å¯¾ãƒ‘ã‚¹ã¨å®Œå…¨URLã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ã€ã©ã¡ã‚‰ã‹ã«çµ±ä¸€ã™ã‚‹ã‹
5. **Pros/Cons**: è©•ä¾¡ãŒå¦¥å½“ã‹

ç¢ºèªãŒå–ã‚Œæ¬¡ç¬¬ã€Phase 2ï¼ˆè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåæ˜ ï¼‰ã«é€²ã¿ã¾ã™ã€‚
