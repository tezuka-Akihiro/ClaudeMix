/**
 * ログインページ
 * ハードコード認証（user/password）
 * Cyberpunk-terminalテーマ
 */

import { json, redirect } from "@remix-run/node";
import type { ActionFunctionArgs } from "@remix-run/node";
import { Form, useActionData } from "@remix-run/react";
import { createUserSession, getUserFromSession } from "~/lib/session/session.server";

export async function loader({ request }: { request: Request }) {
  const user = await getUserFromSession(request);
  if (user) return redirect("/");
  return json({});
}

export async function action({ request }: ActionFunctionArgs) {
  const formData = await request.formData();
  const username = formData.get("username");
  const password = formData.get("password");

  // ハードコード認証（MVP実装）
  if (username === "user" && password === "password") {
    return createUserSession("user-001", "Demo User", "/");
  }

  return json(
    { error: "Invalid credentials" },
    { status: 401 }
  );
}

export default function Login() {
  const actionData = useActionData<typeof action>();

  return (
    <div>
      <div>
        <h1>System Login</h1>

        {actionData?.error && (
          <div>
            {actionData.error}
          </div>
        )}

        <Form method="post">
          <div>
            <label htmlFor="username">Username</label>
            <input
              type="text"
              id="username"
              name="username"
              required
              placeholder="user"
            />
          </div>

          <div>
            <label htmlFor="password">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              placeholder="password"
            />
          </div>

          <button type="submit">
            Login
          </button>
        </Form>

        <div>
          <p>Demo Credentials:</p>
            <code>user / password</code>
          </div>
        </div>
      </div>
    );
}
