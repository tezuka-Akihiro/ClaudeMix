# Phase 2: 計画プロンプト

## AI役割定義

あなたはスキルアーキテクトです。
分析結果を基に、リファクタリング計画を策定してください。

## 前提条件

Phase 1で作成した以下が存在すること：

- 分析レポート（問題点一覧）

## 思考プロセス（CoT）

以下の順序で段階的に計画してください：

```text
Step 1: 問題点を修正の依存関係で整理する
  → どの修正を先にすべきか？

Step 2: フォルダ構成のファイル設計を行う
  → 3層 or 4層？ 何をどこに配置するか？

Step 3: 既存コンテンツの移行先を決定する
  → 何を残し、何を分離するか？

Step 4: 作業順序を決定する
  → 安全に移行するための順序
```

## 実行手順

### Step 1: 修正方針の策定

問題点ごとに修正方針を決定。

| 問題点 | 修正方針 | 優先度 |
| :--- | :--- | :--- |
| 3層構成でない | ディレクトリ作成、ファイル分離 | 高 |
| SSoT違反 | 重複を削除、参照に変更 | 高 |
| プロンプト品質が低い | 6技術を適用 | 中 |
| サイズ超過 | ファイル分割 | 中 |
| When to Useが弱い | セクション追加 | 低 |

### Step 2: ファイル構成の設計

フォルダ構成への移行設計（3層 or 4層）。
scripts/ 追加判断は `docs/skill-architecture.md` の検討プロセスを参照。

```text
移行前:
.claude/skills/{skill-name}.md  (単一ファイル)

移行後（3層）:
.claude/skills/{skill-name}/
├── SKILL.md                    # 司令塔
├── prompts/                    # 金型
│   ├── 01-{phase1}.md
│   └── 02-{phase2}.md
└── docs/                       # 辞書
    └── {reference}.md

移行後（4層）※scripts/が必要な場合:
.claude/skills/{skill-name}/
├── SKILL.md
├── prompts/
├── scripts/                    # 実行ラッパー
│   └── run-{action}.sh
└── docs/
```

### Step 3: コンテンツ移行マッピング

既存コンテンツをどこに移行するか決定。

| 既存セクション | 移行先 | 理由 |
| :--- | :--- | :--- |
| 概要・When to Use | SKILL.md | 司令塔の責務 |
| 実行フロー | SKILL.md | 手順書の責務 |
| 詳細な指示・プロンプト | prompts/ | 金型の責務 |
| 設計基準・失敗パターン | docs/ | 辞書の責務 |
| Output形式 | prompts/ | 金型の一部 |

### Step 4: 作業順序の決定

安全な移行のための順序。

```text
1. 新ディレクトリ作成
2. SKILL.md 作成（フロー定義のみ）
3. prompts/ 作成（プロンプト移行）
4. docs/ 作成（参照ドキュメント移行）
5. 動作確認
6. 旧ファイル削除（ユーザー確認後）
```

## 完了条件チェックリスト

- [ ] 全問題点に修正方針が策定されている
- [ ] フォルダ構成のファイル設計が完了（3層 or 4層）
- [ ] scripts/ 追加の要否が判断されている
- [ ] コンテンツ移行マッピングが完了
- [ ] 作業順序が決定している

## Output形式

```markdown
## リファクタリング計画

### 対象スキル

- スキル名: {skill-name}
- 現在: {現在の構成}
- 移行後: 3層構成 / 4層構成
- scripts/ 追加: 必要 / 不要

### 修正方針

| 問題点 | 修正方針 | 優先度 |
| :--- | :--- | :--- |
| {問題1} | {方針1} | 高/中/低 |
| {問題2} | {方針2} | 高/中/低 |

### ファイル構成（移行後）

```text
.claude/skills/{skill-name}/
├── SKILL.md
├── prompts/
│   ├── {file1}.md
│   └── {file2}.md
├── scripts/                    # ※必要な場合のみ
│   └── run-{action}.sh
└── docs/
    └── {file3}.md
```

### コンテンツ移行マッピング

| 既存セクション | 移行先 |
| :--- | :--- |
| {section1} | SKILL.md |
| {section2} | prompts/{file}.md |
| {定型シェル操作} | scripts/{file}.sh |
| {section3} | docs/{file}.md |

### 作業順序

1. {作業1}
2. {作業2}
3. {作業3}
4. 動作確認
5. 旧ファイル削除
```
