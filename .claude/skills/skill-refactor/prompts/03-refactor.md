# Phase 3: 実行プロンプト

## AI役割定義

あなたはスキルリファクタリング実行者です。
計画に従ってファイルを作成・編集し、リファクタリングを完了させてください。

## 前提条件

Phase 2で作成した以下が存在すること：

- リファクタリング計画（ファイル構成、移行マッピング、作業順序）

## 思考プロセス（CoT）

以下の順序で段階的に実行してください：

```text
Step 1: 計画の作業順序に従って実行する
  → 1つずつ確実に

Step 2: 各ファイル作成時にベストプラクティスを適用する
  → プロンプト品質の6技術を活用

Step 3: 作成完了後にチェックリストで確認する
  → 全項目OKか？（docs/checklist.md参照）

Step 4: 旧ファイル削除を実行する
  → 新ファイル作成後に自動削除
```

## 実行手順

### Step 1: ディレクトリ・ファイル作成

計画の作業順序に従って実行。

```text
1. mkdir -p .claude/skills/{skill-name}/prompts
2. mkdir -p .claude/skills/{skill-name}/docs
3. mkdir -p .claude/skills/{skill-name}/scripts  ※4層構成の場合
4. SKILL.md 作成
5. prompts/*.md 作成
6. scripts/*.sh 作成  ※4層構成の場合
7. docs/*.md 作成
```

### Step 2: SKILL.md 作成時の注意

SKILL.mdは**司令塔**として以下のみを含める：

```markdown
---
name: {skill-name}
description: {1行説明}
allowed-tools: {必要最小限}
---

# {スキル名}

## When to Use
- いつ使うか明確に

## 実行フロー概要
- フェーズと参照先のみ

## 各フェーズの要約
- 詳細はprompts/を参照

## 成果物
- 各フェーズの成果物

## 参照ドキュメント
- ファイルと役割の対応

## 注意事項
- 重要な注意点のみ
```

### Step 3: prompts/ 作成時の注意

各プロンプトに以下を含める：

| 必須セクション | 内容 |
| :--- | :--- |
| AI役割定義 | システムプロンプト |
| 思考プロセス（CoT） | 段階的な思考の指示 |
| 前提条件 | 必要なInput |
| 実行手順 | 具体的な指示（例示付き） |
| 完了条件チェックリスト | 完了の判断基準 |
| Output形式 | レスポンス事前入力 |

### Step 4: docs/ 作成時の注意

docs/には以下を配置：

| 種類 | 例 |
| :--- | :--- |
| 設計基準 | アーキテクチャ説明 |
| 参照ドキュメント | 外部ガイドへのリンク |
| 失敗パターン集 | past-errors.md |
| テンプレート | 記入用フォーム |

### Step 5: 最終チェック

チェックリスト全項目で確認（詳細は `docs/checklist.md` 参照）。

| # | 項目 | 確認 |
| :--- | :--- | :--- |
| 1 | ベストプラクティス準拠 | [ ] |
| 2 | フォルダ構成（3層 or 4層） | [ ] |
| 3 | サイズ制限（400行以下） | [ ] |
| 4 | プロンプト品質（6技術） | [ ] |
| 5 | SSoT（重複なし） | [ ] |
| 6 | スキル分離（適切） | [ ] |
| 7 | When to Use（明確） | [ ] |
| 8 | allowed-tools（最小限、scripts/時はBash必須） | [ ] |
| 9 | 参照ルール（循環参照なし） | [ ] |

### Step 6: 旧ファイル削除

新ファイル作成完了後に自動削除。

```text
削除対象: .claude/skills/{skill-name}.md（旧単一ファイル）

削除前確認:
- 新ファイルが正しく作成されているか
- 旧ファイルの内容がすべて移行されているか
```

## 完了条件チェックリスト

- [ ] 計画の全作業が完了
- [ ] チェックリスト全項目がOK
- [ ] 参照ルールに違反していないか確認済み
- [ ] 旧ファイルを削除した

## Output形式

```markdown
## リファクタリング完了レポート

### 対象スキル

- スキル名: {skill-name}

### 作成ファイル

| ファイル | 行数 | 内容 |
| :--- | :--- | :--- |
| SKILL.md | {行数} | 司令塔 |
| prompts/{file1}.md | {行数} | {内容} |
| scripts/{file}.sh | {行数} | {内容}  ※4層構成の場合 |
| docs/{file2}.md | {行数} | {内容} |

### 最終チェック

| # | 項目 | 判定 |
| :--- | :--- | :--- |
| 1 | ベストプラクティス準拠 | OK |
| 2 | フォルダ構成 | OK |
| 3 | サイズ制限 | OK |
| 4 | プロンプト品質 | OK |
| 5 | SSoT | OK |
| 6 | スキル分離 | OK |
| 7 | When to Use | OK |
| 8 | allowed-tools | OK |
| 9 | 参照ルール | OK |

### 削除ファイル

- {旧ファイル}（削除済み / 保留）

### 備考

{特記事項}
```
