# スコアリング基準

コードレビューのスコアリング基準と判定基準を定義します。

## スコアリング配点

100点満点で評価します。

| 項目 | 配点 | 基準 |
|:---|:---|:---|
| アーキテクチャ準拠 | 30点 | 3大層分離、依存関係の正しさ |
| TDD準拠 | 25点 | テストファースト、カバレッジ |
| TypeScript品質 | 20点 | 型安全性、型定義の明確さ |
| 命名・構造 | 15点 | 規約準拠、可読性 |
| パフォーマンス | 10点 | 最適化、無駄のなさ |
| **合計** | **100点** | - |

## 各項目の詳細

### 1. アーキテクチャ準拠（30点）

3大層アーキテクチャへの準拠度を評価します。

| 観点 | 配点 | 評価基準 |
|:---|:---|:---|
| レイヤー分離 | 10点 | ui/lib/data-ioが正しく分離されている |
| 依存関係 | 10点 | レイヤー間の依存方向が正しい（ui→data-io→lib） |
| 責務の明確さ | 10点 | 各レイヤーの責務が守られている |

**減点例**:

- lib層でasync/awaitを使用: -5点
- ui層でビジネスロジックを記述: -5点
- 循環依存がある: -10点

### 2. TDD準拠（25点）

テスト駆動開発の実践度を評価します。

| 観点 | 配点 | 評価基準 |
|:---|:---|:---|
| E2Eテスト | 10点 | ユーザーストーリーのE2Eテストが存在する |
| ユニットテスト | 10点 | 各関数のユニットテストが存在する |
| テストカバレッジ | 5点 | lib層で100%、その他で80%以上 |

**減点例**:

- E2Eテストが存在しない: -10点
- ユニットテストが存在しない: -10点
- テストカバレッジが50%未満: -5点

### 3. TypeScript品質（20点）

TypeScriptの型安全性と型定義の品質を評価します。

| 観点 | 配点 | 評価基準 |
|:---|:---|:---|
| 型の明示性 | 10点 | 型が明示的に定義されている |
| anyの回避 | 5点 | anyを使用していない（または正当な理由がある） |
| 型安全性 | 5点 | 型エラーがなく、型推論が適切 |

**減点例**:

- anyを不用意に使用: -3点/箇所
- 型定義がない（暗黙のany）: -5点/箇所
- 型アサーション（as）の乱用: -2点/箇所

### 4. 命名・構造（15点）

命名規則とファイル構造の適切さを評価します。

| 観点 | 配点 | 評価基準 |
|:---|:---|:---|
| 命名規則 | 8点 | kebab-case, camelCase, PascalCase が正しく使い分けられている |
| 意図の明確さ | 4点 | 命名が意図を明確に表現している |
| ファイル構造 | 3点 | 1ファイル1責務、適切なディレクトリ配置 |

**減点例**:

- 命名規則違反: -2点/箇所
- 意味不明な略語: -1点/箇所
- 1ファイルに複数の責務: -3点

### 5. パフォーマンス（10点）

パフォーマンスの最適化度を評価します。

| 観点 | 配点 | 評価基準 |
|:---|:---|:---|
| 不要な再レンダリング | 5点 | メモ化が適切に使用されている |
| 計算の効率性 | 3点 | 無駄な計算がない |
| メモリ効率 | 2点 | メモリリークの可能性がない |

**減点例**:

- 不要な再レンダリング: -2点/箇所
- 不要な計算の繰り返し: -2点/箇所
- メモリリークの可能性: -3点

## 判定基準

スコアに基づいて、以下の4段階で判定します。

| スコア範囲 | 判定 | アクション | 説明 |
|:---|:---|:---|:---|
| 90-100 | ✅ Excellent | そのままマージ推奨 | 非常に高品質。改善点がほぼない |
| 75-89 | ✅ Good | 軽微な改善後マージ | 品質は十分。小さな改善で完璧 |
| 60-74 | ⚠️ Needs Improvement | 修正必須 | 問題あり。修正してから再レビュー |
| 0-59 | ❌ Reject | 再実装推奨 | 重大な問題。設計から見直し |

## 判定別の対応

### ✅ Excellent (90-100点)

**特徴**:
- アーキテクチャに完全に準拠
- テストカバレッジ100%
- 型安全性が完璧
- 命名・構造が模範的

**アクション**:
- そのままマージ
- 特に優れた実装はチームで共有

### ✅ Good (75-89点)

**特徴**:
- 基本的な品質は十分
- 軽微な改善点のみ

**アクション**:
- Warningレベルの問題を修正
- Suggestionレベルは任意対応
- 修正後、簡易レビューでマージ

**例**:
- コメント不足
- マジックナンバーの使用
- メモ化の余地

### ⚠️ Needs Improvement (60-74点)

**特徴**:
- 設計思想は理解しているが、実装に問題
- テストが不足
- 型安全性に課題

**アクション**:
- Criticalレベルの問題を全て修正
- Warningレベルの問題も可能な限り修正
- 修正後、完全な再レビュー

**例**:
- レイヤー違反（軽微）
- テストカバレッジ不足
- anyの使用

### ❌ Reject (0-59点)

**特徴**:
- アーキテクチャ違反が複数
- テストが存在しない
- 設計の見直しが必要

**アクション**:
- 設計から見直し
- TDDプロセスに従って再実装
- アーキテクチャの理解を深める

**例**:
- lib層で副作用
- E2Eテスト未実装
- 循環依存

## スコア計算の例

### 例1: Excellent (95点)

```text
アーキテクチャ準拠: 30/30点
  - レイヤー分離: 10/10
  - 依存関係: 10/10
  - 責務の明確さ: 10/10

TDD準拠: 25/25点
  - E2Eテスト: 10/10
  - ユニットテスト: 10/10
  - カバレッジ: 5/5

TypeScript品質: 20/20点
  - 型の明示性: 10/10
  - anyの回避: 5/5
  - 型安全性: 5/5

命名・構造: 15/15点
  - 命名規則: 8/8
  - 意図の明確さ: 4/4
  - ファイル構造: 3/3

パフォーマンス: 5/10点
  - 不要な再レンダリング: 3/5（メモ化の余地あり）
  - 計算の効率性: 2/3
  - メモリ効率: 2/2

合計: 95/100点
判定: ✅ Excellent
```

### 例2: Good (82点)

```text
アーキテクチャ準拠: 25/30点
  - レイヤー分離: 10/10
  - 依存関係: 10/10
  - 責務の明確さ: 5/10（lib層の関数が大きすぎる）

TDD準拠: 22/25点
  - E2Eテスト: 10/10
  - ユニットテスト: 10/10
  - カバレッジ: 2/5（85%）

TypeScript品質: 17/20点
  - 型の明示性: 10/10
  - anyの回避: 2/5（any使用2箇所）
  - 型安全性: 5/5

命名・構造: 13/15点
  - 命名規則: 8/8
  - 意図の明確さ: 2/4（略語が多い）
  - ファイル構造: 3/3

パフォーマンス: 5/10点
  - 不要な再レンダリング: 0/5（メモ化なし）
  - 計算の効率性: 3/3
  - メモリ効率: 2/2

合計: 82/100点
判定: ✅ Good
```

### 例3: Needs Improvement (68点)

```text
アーキテクチャ準拠: 20/30点
  - レイヤー分離: 5/10（lib層でasync使用）
  - 依存関係: 10/10
  - 責務の明確さ: 5/10

TDD準拠: 15/25点
  - E2Eテスト: 10/10
  - ユニットテスト: 5/10（一部テストなし）
  - カバレッジ: 0/5（50%）

TypeScript品質: 15/20点
  - 型の明示性: 10/10
  - anyの回避: 0/5（any多用）
  - 型安全性: 5/5

命名・構造: 10/15点
  - 命名規則: 4/8（kebab-case違反）
  - 意図の明確さ: 3/4
  - ファイル構造: 3/3

パフォーマンス: 8/10点
  - 不要な再レンダリング: 5/5
  - 計算の効率性: 1/3（無駄な計算あり）
  - メモリ効率: 2/2

合計: 68/100点
判定: ⚠️ Needs Improvement
```

---

このスコアリング基準は、レビュー時の参照用です。実際のレビュー手順は `prompts/01-review.md` を参照してください。
