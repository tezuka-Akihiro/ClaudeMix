# 最上位行動原則（マスター・ルール）

このドキュメントは、TDD開発フロー実行時の**最高位の規範**を定義します。

## 🥇 唯一の規範

開発フローは以下の2層で定義されています。他のドキュメントの記述と矛盾する場合、これらが常に優先されます。

### Lv1: フロー骨格

**定義場所**: `docs/flow-formula.md`（元: `docs/boilerplate_architecture/開発フロー簡略図.md`）

**内容**: 絵文字数式による開発の全体構造。テンプレート生成対象ファイルと生成順序を定義。

**絶対ルール**: この数式に記載されていない手順は実行禁止です。記載された手順からの逸脱は許可されません。

### Lv2: フロー詳細

**定義場所**: `prompts/*.md`（元: `docs/boilerplate_architecture/` 配下の各フロー定義書）

**内容**: 各フェーズの具体的な手順、中間成果物、検証方法を定義。

**絶対ルール**: 各フェーズは、対応するプロンプトファイルに記載された手順に厳密に従うこと。

## 🤖 自律性の原則

オペレーター（人間）からの指示は、「Phase 2.1を完了せよ」など、フローのステップ指定のみです。

あなたは、そのステップを完了するために必要な以下のすべてを**自律的に判断・実行**してください：

1. **サブエージェント利用**: generator-operator, debugger, architecture-guardian等を必要に応じて呼び出す
2. **ファイル生成**: `npm run generate`を使用してテンプレートから実際のファイルを生成
3. **リント実行**: `node scripts/lint-template/engine.js`, `npm run lint:css-arch`等を実行
4. **テスト実行**: `npm test`, `npm run test:e2e`を実行
5. **修正**: ガードレール違反やテスト失敗があった場合、自己修正

## 📝 ドキュメントの更新義務

作業完了時、またはステータス変更時、必ず関連する **`TDD_WORK_FLOW.md` の進捗ログを正確に更新**し、進捗を人間と共有してください。

## 🎯 行動指針（6原則）

1. **フロー骨格に従う**: `flow-formula.md`の数式に従い、ステップを順番に実行
2. **自律的に判断**: サブエージェント利用、ファイル生成、リント実行、テスト実行を自分で判断
3. **進捗を記録**: `TDD_WORK_FLOW.md`を常に最新に保つ
4. **ガードレールを実行**: コミット前に必ずすべてのリントを実行し、合格するまで修正
5. **3大層アーキテクチャを遵守**: UI層、純粋ロジック層、副作用層の責務を厳守（CLAUDE.md参照）
6. **SSoT原則を遵守**: すべてのリテラル値は`*-spec.yaml`に定義（YAML_REFERENCE_GUIDE.md参照）

## 🚫 禁止事項

1. **フロー数式の逸脱**: `flow-formula.md`に記載されていない手順を実行すること
2. **手順のスキップ**: 中間成果物を飛ばして次のステップに進むこと
3. **ガードレール無視**: リント検証やテスト実行を省略すること
4. **アーキテクチャ違反**: 3大層分離の原則を破ること
5. **SSoT違反**: ハードコードされたリテラル値を実装に含めること
6. **進捗未記録**: `TDD_WORK_FLOW.md`を更新せずに次のステップに進むこと

## 🎯 目標

この規範に従い、**完璧なコードを製造し、TDD開発フローを完遂すること**です。

## 📚 参照ドキュメント

- `docs/flow-formula.md`: 開発フロー数式マニフェスト
- `docs/guardrails.md`: ガードレール実行ルール
- `CLAUDE.md`: プロジェクト全体のマスタールール
- `docs/boilerplate_architecture/ARCHITECTURE_MANIFESTO2.md`: 3大層アーキテクチャの詳細
