# ブログ記事企画書：【最重要・思想修正】リポジトリ分離とAI時代の構造設計

## 1. 内容の整理（Why / What / Challenge / Solution）

### なぜ行うのか（Why）

筆者が運営するRemix × Cloudflare Edgeのブログ「ClaudeMix」において、**「構造の不自然さ」を未然に防ぎ、システムの寿命を最大化するため。**
リポジトリが肥大化したから対処するのではなく、最初からデプロイ時間の増大とランタイムの不協和音を予見し、アセット管理を「R2への外部接続」前提で設計。Node.js依存の重い処理を「母船（エッジ環境）」から隔離し、10年後も健全な音が鳴り続ける構造を維持する。

### 何をしたのか（What）

画像処理ロジック（リサイズ・WebP変換・R2アップロード）を、ブログ本体から物理的に切り離された独立リポジトリへと移行。Git管理下から画像バイナリを完全に追放し、R2を「不変のインターフェース」とした外部接続構造を確立した。

### どんな壁があったか（Challenge）

- **依存関係の不協和音**: エッジ環境（Workers）において、Node.jsネイティブなライブラリ（Sharp等）の混入は構造上の毒となる。
- **認知の不純度**: 破壊的変更（削除等）の際、検索結果（git grep）に画像処理コードという「ノイズ」が混じり、本質的なロジックの探索を妨げる。
- **AIの思考の鈍化**: モノリスな増築は、AIエージェントに与えるコンテキストを無駄に複雑化させ、コード生成の品質を低下させる。

### どう乗り越えたか（Solution）

- **物理的分離（Decoupling）**: 役割ごとにリポジトリを分けることで、エッジ環境の純度を保つ「隔離病棟」を創設。
- **合理的選択としての手動境界**: 完全自動化の保守コストを避け、Geminiからの保存フローとの連続性を考慮し、あえて「slug（ID）の手動入力」を境界線として設計。
- **AIコンテキストエンジニアリング**: リポジトリを分けることでAIの視界を強制的に限定し、特定ドメインの専門家へと進化させる。

---

## 2. 記事の提供価値

- **ClaudeMix 記録**: 予見的設計に基づくCloudflare R2へのアセット外部化と、リポジトリ分離の実践ログ。
- **ClaudeMix 考察**: AI時代の新機軸「AIコンテキストエンジニアリング」の提唱。モノリスな増築がなぜAIの思考を鈍らせる「悪」なのか、設計思想を深掘りします。

---

## 3. AI時代の分離判断指標（3つの聖域）

増築か分離か迷った際、システムの延命医が診るべき3つの指標。

1. **依存の聖域（ライブラリの純度）**
エッジ環境（母船）の寿命を縮める「重いNode依存」を隔離病棟（別リポジトリ）へ送る。ランタイムの純度を守ることが生存率に直結する。

2. **検索の聖域（認知の純度）**
破壊的変更の際、検索結果にノイズを混ぜない。人間の、そしてAIの「脳のメモリ」を本質に集中させるための物理的分離。

3. **AIの聖域（コンテキストの純度）**
リポジトリを分けることは、AIに対する最強のコンテキストエンジニアリングである。視界を限定することで、AIは迷いなく高品質なコードを生成する。

---

## 4. 核心思想：AIを「特定ドメインの専門家」へ育てる

モノリスなリポジトリは、AIにとって「情報のゴミ屋敷」である。
リポジトリを物理的に分けることで、`CLAUDE.md` 等のプロジェクト設定をそのドメイン（例：画像変換）に特化させることが可能になる。

これにより、AIは「この部屋のことだけ考えればいい」という制約の中で、汎用アシスタントから「圧倒的に高品質なコードを生成する専門家」へと共進化する。**「モノリスな増築はAIの思考を鈍らせる悪である」**。

---

## 5. 品質評価（4基準）

| 基準 | 評価 | 根拠 |
| :--- | :--- | :--- |
| **希少性** | 高 | 「リポジトリ分離 ＝ AIへのコンテキストエンジニアリング」という視点は、従来のソフトウェア設計論にはない独自の知見。 |
| **具体性** | 高 | 3つの聖域という具体的な判断基準と、R2外部接続を前提としたアーキテクチャ図（想定）を提示。 |
| **新規性** | 高 | 2024年以降のAIエージェント（Claude Code等）との共進化を前提とした最新の構造設計論。 |
| **実証性** | 高 | 実際にブログ本体のデプロイ時間を維持し、画像処理専用環境で高品質なコード生成を実現している。 |

**総合評価**: **合格**

---

## 6. 導入部分構成（恐怖型BAB法）

### Before（恐怖の提示）

「とりあえず、この機能もブログのリポジトリに追加しておこう」。その甘い考えが、あなたのシステムを情報のゴミ屋敷へと変えていきます。肥大化する依存関係、ノイズだらけの検索結果、そして何より、複雑すぎるコンテキストに溺れて「バカ」になっていくAI。気づけば、誰も手を付けられない「死んだモノリス」がそこにあります。

### After（希望の提示）

役割ごとに隔離された、純度の高いリポジトリ群。エッジランタイムは常に軽量で、検索結果には本質だけが並ぶ。そして、限定された視界の中で「専門家」として覚醒したAIが、あなたの意図を完璧に汲み取ったコードを生成し続ける。システムは、まるで呼吸するように軽やかに進化していきます。

### Bridge（解決策の提示）

解決策は、単なる「整理整頓」ではありません。AI時代の生存戦略としての「リポジトリ分離」と「3つの聖域」による構造設計です。AIを迷わせず、自分を守るための「隔離」と「外部化」の具体的手法を解説します。

---

## 7. カテゴリ・タグ

- **メインカテゴリ**: ClaudeMix 考察
- **サブカテゴリ**: ClaudeMix 記録
- **タグ**: `architecture`, `ai-context-engineering`, `cloudflare-r2`, `decoupling`, `refactoring`

---

## 8. オペレーターへの確認事項

1. 「AIコンテキストエンジニアリング」という言葉の定義について、もう少し補足が必要でしょうか？
2. 隔離病棟（画像処理リポジトリ）側でのAIの振る舞い（専門特化したプロンプト等）の具体例も、この記事内で触れるべきでしょうか？
3. 結論部分で「AIに使えば道具は一瞬で作れるが、置き場所こそが重要」というメッセージを強調しますが、これに付随して「管理コストの逆転現象」についても触れますか？

---

## 9. プロダクト固有用語チェック

- [x] ClaudeMix → 筆者が運営するRemix × Cloudflare Edgeのブログ「ClaudeMix」
- [x] lib層 / data-io層 → ビジネスロジック層（app/lib/） / データアクセス層（app/data-io/）

---

## 結びに代えて

AIを使えば、サムネイル生成ツールのような「道具」は一瞬で作れる時代になりました。しかし、**「作った道具をどこに置くか（リポジトリ戦略）」**こそが、5〜10年死なないプロダクトの成否を分ける決定的な境界線となります。

---
