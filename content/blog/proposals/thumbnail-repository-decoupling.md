# ブログ記事企画書：サムネイルリポジトリの分離とアセット管理の外部化

## 1. 内容の整理（Why / What / Challenge / Solution）

### なぜ行うのか（Why）

筆者が運営するRemix × Cloudflare Edgeのブログ「ClaudeMix」において、リポジトリの肥大化を防ぎ、開発環境と実行環境（エッジ）の不一致による技術的負債を解消するため。具体的には、Node.jsに強く依存する画像処理ライブラリ（Sharp等）をエッジ環境で動作するブログ本体から分離し、システムの「生存性」と「軽快さ」を担保する。

### 何をしたのか（What）

画像処理ロジック（リサイズ・WebP変換・アップロード）をブログ本体から物理的に切り出し、専用のリポジトリを創設した。また、画像データそのものをGit管理から排除し、Cloudflare R2ストレージへと完全に移行。ブログ側からはR2の不変URLで参照する構造を確立した。

### どんな壁があったか（Challenge）

- **リポジトリの肥大化**: 大量の画像バイナリがGitに含まれることで、クローンやCI/CDの時間が劇的に増加していた。
- **依存関係の不協和音**: 画像処理に必要なNode.jsネイティブなライブラリが、Cloudflare Workers（Edgeランタイム）を前提としたブログ本体のパッケージ構成を複雑にし、ビルドエラーの原因となっていた。
- **認知負荷の増大**: `git grep` 等でコードを検索する際、画像処理関連のノイズが混じり、純粋なビジネスロジックの探索を妨げていた。

### どう乗り越えたか（Solution）

- **物理的分離（Decoupling）**: 重い処理を行う「Node.js環境のリポジトリ」と、配信に特化した「エッジ環境のリポジトリ」に役割を明確に分けた。
- **外部ストレージ戦略**: アセットをR2に逃がすことで、リポジトリの場所を問わず一意のパスで参照できる「ユニバーサルなインターフェース」を構築。
- **手動境界線の設計**: 完全自動化による「意図しない上書き」のリスクを避けるため、あえて「slug（ID）の手動入力」をプロセスに残し、オペレーションの安全性を確保した。

---

## 2. 記事の提供価値

- **ClaudeMix 記録**: Cloudflare R2への移行手順と、Edge環境でのリポジトリ軽量化の実践記録を提供します。
- **ClaudeMix 考察**: 「最大の努力で最小の結果（死なないこと）を生む」という行動哲学に基づき、あえて自動化を限定し「手動の境界線」を設ける設計思想を紹介します。

---

## 3. 品質評価（4基準）

| 基準 | 評価 | 根拠 |
| :--- | :--- | :--- |
| **希少性** | 高 | Edge環境での制約を回避するための「リポジトリ単位の分離」という、泥臭くも合理的な設計判断は巷の記事では少ない。 |
| **具体性** | 高 | 1. 記事作成 2. 画像処理実行 3. URL参照 という、読者が明日から真似できる3ステップのワークフローを提示している。 |
| **新規性** | 高 | Cloudflare R2とRemixের最新の組み合わせ、およびClaude Codeを用いた開発基盤における「ノイズ排除」の観点を含んでいる。 |
| **実証性** | 高 | 実際にこのブログの開発基盤で行われたリファクタリングであり、Lighthouse 100点とCI/CD高速化を両立している。 |

**総合評価**: **合格**（すべての基準を満たしています）

---

## 4. 導入部分構成（恐怖型BAB法）

### Before（恐怖の提示）

画像が増えるたびに重くなるリポジトリ、遅れていくCI/CD。そして何より、エッジで動かないはずの重厚なNode.jsライブラリが、あなたのクリーンなプロジェクト構成を侵食していく恐怖。いずれ開発スピードはゼロになり、システムは自重で崩壊します。

### After（希望の提示）

リポジトリは常に軽量で、デプロイは一瞬で終わる。画像処理の複雑な依存関係は別世界に閉じ込められ、ブログ本体はWeb標準に準拠した純粋な姿を取り戻します。検索結果からノイズが消え、あなたは本来の執筆と機能開発に集中できます。

### Bridge（解決策の提示）

解決策は「リポジトリの物理的な分離」と「R2への外部化」です。あえて「自動化しない部分」を作ることで安全性を確保しつつ、システムの延命を図る具体的なアーキテクチャを解説します。

---

## 5. カテゴリ・タグ

- **メインカテゴリ**: ClaudeMix 考察
- **サブカテゴリ**: ClaudeMix 記録
- **タグ**: `architecture`, `cloudflare-r2`, `remix`, `refactoring`, `image-optimization`

---

## 6. オペレーターへの確認事項

1. 記事の中で、具体的なフォルダ構成や `package.json` の差分を詳しく解説すべきでしょうか？それとも設計思想に重きを置くべきでしょうか？
2. 「手動入力」を安全装置とする考え方について、もう少し技術的なメリット（冪等性の担保など）を掘り下げて記述したほうがよいでしょうか？
3. 分離先の画像リポジトリで採用した具体的なライブラリ（Sharp, AWS SDK for R2等）についても、別記事に分けるのではなく、この記事内で軽く触れる程度でよろしいでしょうか？

---

## 7. プロダクト固有用語チェック

- [x] ClaudeMix → 筆者が運営するRemix × Cloudflare Edgeのブログ「ClaudeMix」
- [x] lib層 / data-io層 → ビジネスロジック層（app/lib/） / データアクセス層（app/data-io/）
- [x] オペレーター → オペレーター（文脈に応じて使用）
